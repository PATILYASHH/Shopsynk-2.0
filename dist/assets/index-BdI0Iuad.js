import{r as i,a as He,N as Ae,u as te,b as Je,R as Ye,L as Te,d as Ve,B as We,e as Ce,f as M}from"./vendor-DsmcgGc9.js";import{c as Ze}from"./supabase-6T48ApRq.js";import{X as Xe,M as Ke,U as re,L as Qe,H as es,a as X,R as V,F as ss,b as ae,c as we,E as Ne,d as ie,A as Fe,P as ve,D as Q,T as De,e as _e,f as Se,S as Be,g as Ie,h as Le,i as qe,j as Re,k as ts,C as pe,l as ge,m as se,n as rs,o as Me,p as as,q as ns,r as ke,s as ls,t as is,u as be,v as cs,w as os,x as Pe,y as fe,z as ye,B as ds,G as Ee,I as us,J as je}from"./ui-D37jTwe_.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const x of c)if(x.type==="childList")for(const f of x.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function a(c){const x={};return c.integrity&&(x.integrity=c.integrity),c.referrerPolicy&&(x.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?x.credentials="include":c.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function s(c){if(c.ep)return;c.ep=!0;const x=a(c);fetch(c.href,x)}})();var Ue={exports:{}},ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ms=i,xs=Symbol.for("react.element"),hs=Symbol.for("react.fragment"),ps=Object.prototype.hasOwnProperty,gs=ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bs={key:!0,ref:!0,__self:!0,__source:!0};function $e(r,t,a){var s,c={},x=null,f=null;a!==void 0&&(x=""+a),t.key!==void 0&&(x=""+t.key),t.ref!==void 0&&(f=t.ref);for(s in t)ps.call(t,s)&&!bs.hasOwnProperty(s)&&(c[s]=t[s]);if(r&&r.defaultProps)for(s in t=r.defaultProps,t)c[s]===void 0&&(c[s]=t[s]);return{$$typeof:xs,type:r,key:x,ref:f,props:c,_owner:gs.current}}ce.Fragment=hs;ce.jsx=$e;ce.jsxs=$e;Ue.exports=ce;var e=Ue.exports,Ge,Oe=He;Ge=Oe.createRoot,Oe.hydrateRoot;const fs="https://gxgiqmmlvdgrzvbgmgfp.supabase.co",ys="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4Z2lxbW1sdmRncnp2YmdtZ2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTA4OTEsImV4cCI6MjA3MTY2Njg5MX0.VzO5yGWCFpN6ZU7d76tK9ADFPNwukuQ96RD3iILpAg0",y=Ze(fs,ys),ze=i.createContext(void 0),U=()=>{const r=i.useContext(ze);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},js=({children:r})=>{const[t,a]=i.useState(null),[s,c]=i.useState(!0);i.useEffect(()=>{y.auth.getUser().then(({data:{user:v}})=>{a(v),c(!1)});const{data:{subscription:N}}=y.auth.onAuthStateChange((v,d)=>{a((d==null?void 0:d.user)??null),c(!1)});return()=>N.unsubscribe()},[]);const E={user:t,loading:s,signUp:async(N,v)=>{const{data:d,error:j}=await y.auth.signUp({email:N,password:v});return{data:d,error:j}},signIn:async(N,v)=>{const{data:d,error:j}=await y.auth.signInWithPassword({email:N,password:v});return{data:d,error:j}},signOut:async()=>{const{error:N}=await y.auth.signOut();if(N)throw N}};return e.jsx(ze.Provider,{value:E,children:r})},ws=({children:r})=>{const{user:t,loading:a}=U();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):t?e.jsx(e.Fragment,{children:r}):e.jsx(Ae,{to:"/login",replace:!0})},Ns=({children:r})=>{const{user:t,signOut:a}=U(),s=te(),c=Je(),[x,f]=Ye.useState(!1),C=async()=>{try{await a(),s("/login")}catch(v){console.error("Error signing out:",v)}},E=[{name:"Dashboard",path:"/",icon:es},{name:"Suppliers",path:"/suppliers",icon:X},{name:"Transactions",path:"/transactions",icon:V},{name:"Reports",path:"/reports",icon:ss},{name:"Profile",path:"/profile",icon:re}],N=v=>v==="/"?c.pathname==="/":c.pathname.startsWith(v);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:e.jsx("button",{onClick:()=>f(!x),className:"bg-white p-2 rounded-lg shadow-md border border-gray-200 hover:bg-gray-50 transition-colors",children:x?e.jsx(Xe,{className:"h-6 w-6"}):e.jsx(Ke,{className:"h-6 w-6"})})}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg border-r border-gray-200 transform transition-transform duration-200 ease-in-out lg:translate-x-0 ${x?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-center h-16 bg-blue-600 text-white",children:e.jsx("h1",{className:"text-xl font-bold",children:"Shopsynk"})}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:E.map(v=>{const d=v.icon;return e.jsxs("button",{onClick:()=>{s(v.path),f(!1)},className:`w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ${N(v.path)?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(d,{className:"h-5 w-5 mr-3"}),v.name]},v.name)})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(re,{className:"h-4 w-4 text-blue-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t==null?void 0:t.email})})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",title:"Sign out",children:e.jsx(Qe,{className:"h-4 w-4"})})]})})]})}),e.jsx("div",{className:"lg:pl-64",children:e.jsx("main",{className:"p-6 lg:p-8",children:r})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>f(!1)})]})},vs=()=>{const[r,t]=i.useState(""),[a,s]=i.useState(""),[c,x]=i.useState(!1),[f,C]=i.useState(!1),[E,N]=i.useState(""),{signIn:v}=U(),d=te(),j=async h=>{h.preventDefault(),C(!0),N("");try{const{error:p}=await v(r,a);if(p)throw p;d("/")}catch(p){N(p.message)}finally{C(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sign in to manage your supplier dues"})]}),E&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:E}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:r,onChange:h=>t(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:c?"text":"password",value:a,onChange:h=>s(h.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your password",required:!0}),e.jsx("button",{type:"button",onClick:()=>x(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:c?e.jsx(Ne,{className:"h-5 w-5"}):e.jsx(ie,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:f?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Sign In",e.jsx(Fe,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(Te,{to:"/register",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Create one"})]})})]})})})},_s=()=>{const[r,t]=i.useState(""),[a,s]=i.useState(""),[c,x]=i.useState(""),[f,C]=i.useState(!1),[E,N]=i.useState(!1),[v,d]=i.useState(!1),[j,h]=i.useState(""),[p,g]=i.useState(""),{signUp:k}=U(),w=te(),D=async S=>{if(S.preventDefault(),d(!0),h(""),g(""),a!==c){h("Passwords do not match"),d(!1);return}try{const{error:u}=await k(r,a);if(u)throw u;g("Account created successfully! You can now sign in."),setTimeout(()=>w("/login"),2e3)}catch(u){h(u.message)}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Start managing your supplier dues today"})]}),j&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:j}),p&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-600 text-sm",children:p}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:r,onChange:S=>t(S.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:f?"text":"password",value:a,onChange:S=>s(S.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Create a password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>C(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:f?e.jsx(Ne,{className:"h-5 w-5"}):e.jsx(ie,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:E?"text":"password",value:c,onChange:S=>x(S.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Confirm your password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>N(!E),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:E?e.jsx(Ne,{className:"h-5 w-5"}):e.jsx(ie,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:v,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:v?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Create Account",e.jsx(Fe,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(Te,{to:"/login",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})})]})})})},Ss=()=>{const{user:r}=U(),t=te(),[a,s]=i.useState({totalDues:0,totalSuppliers:0,totalTransactions:0,pendingPayments:0,recentTransactions:[],upcomingDues:[]}),[c,x]=i.useState(!0);i.useEffect(()=>{f()},[r]);const f=async()=>{if(r)try{const{count:d}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",r.id),{count:j}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",r.id),{data:h}=await y.from("transactions").select("*").eq("user_id",r.id),p=new Map;h==null||h.forEach(o=>{const b=o.supplier_id;p.has(b)||p.set(b,0),o.type==="new_purchase"?p.set(b,p.get(b)+parseFloat(o.amount)):(o.type==="pay_due"||o.type==="settle_bill")&&p.set(b,p.get(b)-parseFloat(o.amount))});let g=0,k=0;p.forEach(o=>{o>.01&&(g+=o,k++)});const{data:w}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",r.id).order("created_at",{ascending:!1}).limit(5),{data:D}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",r.id).order("created_at",{ascending:!1}),S=new Map;D==null||D.forEach(o=>{var B;const b=o.supplier_id,T=(B=o.supplier)==null?void 0:B.name;S.has(b)||S.set(b,{supplier_id:b,supplier_name:T,balance:0,lastTransaction:o,dueDate:null});const O=S.get(b);o.type==="new_purchase"?(O.balance+=parseFloat(o.amount),o.due_date&&(!O.dueDate||o.due_date<O.dueDate)&&(O.dueDate=o.due_date)):(o.type==="pay_due"||o.type==="settle_bill")&&(O.balance-=parseFloat(o.amount))});const u=Array.from(S.values()).filter(o=>o.balance>.01).map(o=>({id:`outstanding-${o.supplier_id}`,supplier_id:o.supplier_id,supplier:{name:o.supplier_name},amount:o.balance.toFixed(2),description:"Outstanding balance",due_date:o.dueDate,type:"outstanding"})).sort((o,b)=>o.due_date&&!b.due_date?-1:!o.due_date&&b.due_date?1:o.due_date&&b.due_date&&o.due_date!==b.due_date?o.due_date.localeCompare(b.due_date):parseFloat(b.amount)-parseFloat(o.amount)).slice(0,10);s({totalDues:Math.max(0,g),totalSuppliers:d||0,totalTransactions:j||0,pendingPayments:k,recentTransactions:w||[],upcomingDues:u||[]})}catch(d){console.error("Error fetching dashboard data:",d)}finally{x(!1)}},C=d=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),E=d=>new Date(d).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),N=d=>{switch(d){case"new_purchase":return e.jsx(Se,{className:"h-4 w-4 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(_e,{className:"h-4 w-4 text-green-500"});default:return e.jsx(V,{className:"h-4 w-4 text-gray-500"})}},v=d=>{switch(d){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return d}};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Welcome back! Here's your business overview."})]}),e.jsxs("button",{onClick:()=>t("/transactions/new"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C(a.totalDues)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(Q,{className:"h-6 w-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalSuppliers})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalTransactions})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Payments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.pendingPayments})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center",children:e.jsx(De,{className:"h-6 w-6 text-yellow-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"}),e.jsx("button",{onClick:()=>t("/transactions"),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-4",children:a.recentTransactions.length>0?a.recentTransactions.map(d=>{var j,h;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>t(`/suppliers/${d.supplier_id}`),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[N(d.type),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(j=d.supplier)==null?void 0:j.name}),e.jsx("p",{className:"text-sm text-gray-600",children:v(d.type)}),((h=d.owner)==null?void 0:h.owner_name)&&e.jsxs("p",{className:"text-xs text-blue-600",children:[d.type==="new_purchase"?"Purchased by: ":"Paid by: ",d.owner.owner_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-medium ${d.type==="new_purchase"?"text-red-600":"text-green-600"}`,children:[d.type==="new_purchase"?"+":"-",C(parseFloat(d.amount))]}),e.jsx("p",{className:"text-sm text-gray-500",children:E(d.created_at)})]})]},d.id)}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No transactions yet"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Outstanding Payments"}),e.jsx(De,{className:"h-5 w-5 text-orange-400"})]}),e.jsx("div",{className:"space-y-4",children:a.upcomingDues.length>0?a.upcomingDues.map(d=>{var j;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition-colors cursor-pointer",onClick:()=>t(`/suppliers/${d.supplier_id}`),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(j=d.supplier)==null?void 0:j.name}),e.jsx("p",{className:"text-sm text-gray-600",children:d.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-red-600",children:C(parseFloat(d.amount))}),e.jsx("p",{className:"text-sm text-gray-500",children:d.due_date?`Due: ${E(d.due_date)}`:"No due date"})]})]},d.id)}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No outstanding payments"})})]})]})]})},Cs=()=>{const{user:r}=U(),t=te(),[a,s]=i.useState([]),[c,x]=i.useState(!0),[f,C]=i.useState(""),[E,N]=i.useState(!1),[v,d]=i.useState(null),[j,h]=i.useState({name:"",contact_person:"",phone:"",email:"",address:""});i.useEffect(()=>{p()},[r]);const p=async()=>{if(r)try{const{data:u,error:o}=await y.from("suppliers").select("*").eq("user_id",r.id).order("name");if(o)throw o;s(u||[])}catch(u){console.error("Error fetching suppliers:",u)}finally{x(!1)}},g=async u=>{if(u.preventDefault(),!!r)try{if(v){const{error:o}=await y.from("suppliers").update(j).eq("id",v.id).eq("user_id",r.id);if(o)throw o}else{const{error:o}=await y.from("suppliers").insert([{...j,user_id:r.id}]);if(o)throw o}await p(),D()}catch(o){console.error("Error saving supplier:",o)}},k=u=>{d(u),h({name:u.name,contact_person:u.contact_person||"",phone:u.phone||"",email:u.email||"",address:u.address||""}),N(!0)},w=async u=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:o}=await y.from("suppliers").delete().eq("id",u).eq("user_id",r.id);if(o)throw o;await p()}catch(o){console.error("Error deleting supplier:",o)}},D=()=>{h({name:"",contact_person:"",phone:"",email:"",address:""}),d(null),N(!1)},S=a.filter(u=>u.name.toLowerCase().includes(f.toLowerCase())||u.contact_person&&u.contact_person.toLowerCase().includes(f.toLowerCase()));return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Suppliers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your supplier relationships"})]}),e.jsxs("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:f,onChange:u=>C(u.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(u=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:u.name}),u.contact_person&&e.jsx("p",{className:"text-sm text-gray-600",children:u.contact_person})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>t(`/suppliers/${u.id}`),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",title:"View details",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>k(u),className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50",title:"Edit supplier",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>w(u.id),className:"p-2 text-gray-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:"Delete supplier",children:e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[u.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:u.phone})]}),u.email&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:u.email})]}),u.address&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"line-clamp-2",children:u.address})]})]})]},u.id))}),S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:f?"No suppliers found":"No suppliers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:f?"Try adjusting your search terms.":"Start by adding your first supplier to begin tracking dues."}),!f&&e.jsx("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Supplier"})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:v?"Edit Supplier":"Add New Supplier"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",required:!0,value:j.name,onChange:u=>h({...j,name:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",value:j.contact_person,onChange:u=>h({...j,contact_person:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:j.phone,onChange:u=>h({...j,phone:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:j.email,onChange:u=>h({...j,email:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:j.address,onChange:u=>h({...j,address:u.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter address"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[v?"Update":"Create"," Supplier"]})]})]})]})})]})};class Y{static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}async getBusinessOwners(t){try{const{data:a,error:s}=await y.from("business_owners").select("*").eq("user_id",t).eq("is_active",!0).order("is_primary",{ascending:!1}).order("created_at",{ascending:!0});if(s)throw s;return a||[]}catch(a){return console.error("Error fetching business owners:",a),[]}}async getPrimaryOwner(t){try{const{data:a,error:s}=await y.from("business_owners").select("*").eq("user_id",t).eq("is_primary",!0).eq("is_active",!0).single();if(s&&s.code!=="PGRST116")throw s;return a||null}catch(a){return console.error("Error fetching primary owner:",a),null}}async createBusinessOwner(t,a){try{const{data:s,error:c}=await y.from("business_owners").insert([{user_id:t,owner_name:a.owner_name,role:a.role||"Owner",is_primary:!1,is_active:!0}]).select().single();if(c)throw c;return{success:!0,data:s}}catch(s){return console.error("Error creating business owner:",s),{success:!1,error:s.message||"Failed to create business owner"}}}async updateBusinessOwner(t,a){try{const{data:s,error:c}=await y.from("business_owners").update({owner_name:a.owner_name,role:a.role,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(c)throw c;return{success:!0,data:s}}catch(s){return console.error("Error updating business owner:",s),{success:!1,error:s.message||"Failed to update business owner"}}}async deactivateBusinessOwner(t){try{const{data:a,error:s}=await y.from("business_owners").select("is_primary").eq("id",t).single();if(s)throw s;if(a.is_primary)return{success:!1,error:"Cannot deactivate the primary owner"};const{error:c}=await y.from("business_owners").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",t);if(c)throw c;return{success:!0}}catch(a){return console.error("Error deactivating business owner:",a),{success:!1,error:a.message||"Failed to deactivate business owner"}}}async getOwnerStats(t){try{const{data:a,error:s}=await y.from("owner_transaction_stats").select("*").eq("user_id",t);if(s)throw s;return a||[]}catch(a){return console.error("Error fetching owner stats:",a),[]}}async ensurePrimaryOwner(t,a,s){try{const c=await this.getPrimaryOwner(t);if(c)return c;const x=await this.createBusinessOwner(t,{owner_name:s||a.split("@")[0],role:"Primary Owner",is_primary:!0});return x.success?x.data:null}catch(c){return console.error("Error ensuring primary owner:",c),null}}async updateTransactionOwner(t,a){try{const{error:s}=await y.from("transactions").update({owner_id:a}).eq("id",t);if(s)throw s;return{success:!0}}catch(s){return console.error("Error updating transaction owner:",s),{success:!1,error:s.message||"Failed to update transaction owner"}}}async updateSupplierOwner(t,a){try{const{error:s}=await y.from("suppliers").update({added_by_owner_id:a}).eq("id",t);if(s)throw s;return{success:!0}}catch(s){return console.error("Error updating supplier owner:",s),{success:!1,error:s.message||"Failed to update supplier owner"}}}}const Ds=()=>{const{id:r}=Ve(),{user:t}=U(),a=te(),[s,c]=i.useState(null),[x,f]=i.useState([]),[C,E]=i.useState([]),[N,v]=i.useState(!0),[d,j]=i.useState(!1),[h,p]=i.useState(!1),[g,k]=i.useState(""),[w,D]=i.useState(""),[S,u]=i.useState(""),[o,b]=i.useState(""),[T,O]=i.useState(""),[B,L]=i.useState(""),[$,l]=i.useState(""),[A,I]=i.useState(0),[P,H]=i.useState({totalPurchases:0,totalPaid:0,totalDue:0,transactionCount:0});i.useEffect(()=>{r&&W()},[r,t]);const W=async()=>{if(!(!t||!r))try{const{data:m,error:F}=await y.from("suppliers").select("*").eq("id",r).eq("user_id",t.id).single();if(F)throw F;const{data:G,error:le}=await y.from("transactions").select(`
          *,
          owner:business_owners(owner_name)
        `).eq("supplier_id",r).eq("user_id",t.id).order("created_at",{ascending:!1});if(le)throw le;const K=await Y.getInstance().getBusinessOwners(t.id);c(m),f(G||[]),E(K||[]);let n=0,_=0,R=0;G==null||G.forEach(z=>{const q=parseFloat(z.amount.toString());z.type==="new_purchase"?(n+=q,z.is_paid||(R+=q)):(z.type==="pay_due"||z.type==="settle_bill")&&(_+=q,R-=q)}),I(Math.max(0,R)),H({totalPurchases:n,totalPaid:_,totalDue:Math.max(0,R),transactionCount:(G==null?void 0:G.length)||0})}catch(m){console.error("Error fetching supplier data:",m)}finally{v(!1)}},oe=async m=>{if(m.preventDefault(),!(!t||!r||!g))try{const{error:F}=await y.from("transactions").insert([{user_id:t.id,supplier_id:r,type:"pay_due",amount:parseFloat(g),description:$||"Payment made",is_paid:!0,owner_id:w||null}]);if(F)throw F;await W(),j(!1),k(""),D(""),l("")}catch(F){console.error("Error processing payment:",F)}},de=async m=>{if(m.preventDefault(),!(!t||!r||!S))try{const{error:F}=await y.from("transactions").insert([{user_id:t.id,supplier_id:r,type:"new_purchase",amount:parseFloat(S),description:T||"New purchase",due_date:B||null,is_paid:!1,owner_id:o||null}]);if(F)throw F;await W(),p(!1),u(""),b(""),O(""),L("")}catch(F){console.error("Error adding purchase:",F)}},J=m=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),ne=m=>new Date(m).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),ue=m=>{switch(m){case"new_purchase":return e.jsx(Se,{className:"h-5 w-5 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(_e,{className:"h-5 w-5 text-green-500"});default:return e.jsx(V,{className:"h-5 w-5 text-gray-500"})}},me=m=>{switch(m){case"new_purchase":return"Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return m}},xe=m=>{switch(m){case"new_purchase":return"text-red-600";case"pay_due":case"settle_bill":return"text-green-600";default:return"text-gray-600"}};return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>a("/suppliers"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ts,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Supplier Details & Transaction History"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>j(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:J(P.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ge,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Paid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:J(P.totalPaid)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Outstanding Due"}),e.jsx("p",{className:`text-2xl font-bold ${P.totalDue>0?"text-red-600":"text-gray-400"}`,children:J(P.totalDue)})]}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${P.totalDue>0?"bg-red-100":"bg-gray-100"}`,children:e.jsx(Q,{className:`h-6 w-6 ${P.totalDue>0?"text-red-600":"text-gray-400"}`})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:P.transactionCount})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-gray-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.name}),s.contact_person&&e.jsx("p",{className:"text-gray-600",children:s.contact_person})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qe,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ae,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:s.email})]}),s.address&&e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Re,{className:"h-5 w-5 text-gray-400 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:s.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Status"}),e.jsx(Q,{className:"h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Rate"}),e.jsx("span",{className:"text-sm font-medium",children:P.totalPurchases>0?`${Math.round(P.totalPaid/P.totalPurchases*100)}%`:"0%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:P.totalPurchases>0?`${Math.min(P.totalPaid/P.totalPurchases*100,100)}%`:"0%"}})}),e.jsxs("div",{className:"text-center pt-2",children:[e.jsx("p",{className:`text-2xl font-bold ${P.totalDue>0?"text-red-600":"text-green-600"}`,children:P.totalDue>0?J(P.totalDue):"All Clear!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P.totalDue>0?"Outstanding Balance":"No pending dues"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transaction History"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>j(!0),className:"bg-green-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"New Purchase"]})]})]})}),e.jsx("div",{className:"p-6",children:x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(m=>{var F;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ue(m.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:me(m.type)}),!m.is_paid&&m.type==="new_purchase"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"Unpaid"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:m.description}),((F=m.owner)==null?void 0:F.owner_name)&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[m.type==="new_purchase"?"Purchased by: ":"Paid by: ",m.owner.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),ne(m.created_at)]}),m.due_date&&e.jsxs("span",{children:["Due: ",ne(m.due_date)]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`text-lg font-semibold ${xe(m.type)}`,children:[m.type==="new_purchase"?"+":"-",J(parseFloat(m.amount.toString()))]})})]})},m.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet with this supplier"})]})})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["Pay Due to ",s.name]}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:g,onChange:m=>k(m.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter payment amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:$,onChange:m=>l(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Payment description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Made By"}),e.jsxs("select",{value:w,onChange:m=>D(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select who made this payment"}),C.map(m=>e.jsxs("option",{value:m.id,children:[m.owner_name," ",m.is_primary&&"(Primary)"," - ",m.role]},m.id))]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:["Current outstanding: ",e.jsx("span",{className:"font-medium",children:J(A)})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Process Payment"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["New Purchase from ",s.name]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:S,onChange:m=>u(m.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter purchase amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:T,onChange:m=>O(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Purchase description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Made By"}),e.jsxs("select",{value:o,onChange:m=>b(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select who made this purchase"}),C.map(m=>e.jsxs("option",{value:m.id,children:[m.owner_name," ",m.is_primary&&"(Primary)"," - ",m.role]},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:B,onChange:m=>L(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Purchase"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Supplier not found"}),e.jsx("button",{onClick:()=>a("/suppliers"),className:"text-blue-600 hover:text-blue-700",children:"Back to Suppliers"})]})},ks=()=>{const{user:r}=U(),[t,a]=i.useState([]),[s,c]=i.useState([]),[x,f]=i.useState([]),[C,E]=i.useState(!0),[N,v]=i.useState(""),[d,j]=i.useState("all"),[h,p]=i.useState("all"),[g,k]=i.useState(!1),[w,D]=i.useState({supplier_id:"",type:"new_purchase",amount:"",description:"",due_date:"",is_paid:!1,owner_id:""});i.useEffect(()=>{S()},[r]);const S=async()=>{if(r)try{const{data:l,error:A}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",r.id).order("created_at",{ascending:!1});if(A)throw A;const{data:I,error:P}=await y.from("suppliers").select("*").eq("user_id",r.id).order("name");if(P)throw P;const W=await Y.getInstance().getBusinessOwners(r.id);a(l||[]),c(I||[]),f(W||[])}catch(l){console.error("Error fetching data:",l)}finally{E(!1)}},u=async l=>{if(l.preventDefault(),!!r)try{const A={...w,user_id:r.id,amount:parseFloat(w.amount),due_date:w.due_date||null,owner_id:w.owner_id||null},{error:I}=await y.from("transactions").insert([A]);if(I)throw I;await S(),o()}catch(A){console.error("Error creating transaction:",A)}},o=()=>{D({supplier_id:"",type:"new_purchase",amount:"",description:"",due_date:"",is_paid:!1,owner_id:""}),k(!1)},b=t.filter(l=>{var H;const A=((H=l.supplier)==null?void 0:H.name.toLowerCase().includes(N.toLowerCase()))||l.description.toLowerCase().includes(N.toLowerCase()),I=d==="all"||l.type===d,P=h==="all"||h==="paid"&&l.is_paid||h==="unpaid"&&!l.is_paid;return A&&I&&P}),T=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),O=l=>new Date(l).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),B=l=>{switch(l){case"new_purchase":return e.jsx(Se,{className:"h-5 w-5 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(_e,{className:"h-5 w-5 text-green-500"});default:return e.jsx(V,{className:"h-5 w-5 text-gray-500"})}},L=l=>{switch(l){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return l}},$=l=>{switch(l){case"new_purchase":return"text-red-600";case"pay_due":case"settle_bill":return"text-green-600";default:return"text-gray-600"}};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Transactions"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track all your supplier transactions"})]}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:N,onChange:l=>v(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("select",{value:d,onChange:l=>j(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"new_purchase",children:"New Purchase"}),e.jsx("option",{value:"pay_due",children:"Payment"}),e.jsx("option",{value:"settle_bill",children:"Settlement"})]}),e.jsxs("select",{value:h,onChange:l=>p(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"unpaid",children:"Unpaid"})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),b.length," transactions"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:b.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(l=>{var A,I;return e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:B(l.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:(A=l.supplier)==null?void 0:A.name}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full",children:L(l.type)}),!l.is_paid&&l.type==="new_purchase"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"Unpaid"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:l.description}),((I=l.owner)==null?void 0:I.owner_name)&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[l.type==="new_purchase"?"Purchased by: ":"Paid by: ",l.owner.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),O(l.created_at)]}),l.due_date&&e.jsxs("span",{className:"flex items-center",children:["Due: ",O(l.due_date)]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`text-lg font-semibold ${$(l.type)}`,children:[l.type==="new_purchase"?"+":"-",T(parseFloat(l.amount.toString()))]})})]})},l.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:N||d!=="all"||h!=="all"?"No transactions found":"No transactions yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:N||d!=="all"||h!=="all"?"Try adjusting your search or filters.":"Start by adding your first transaction."}),!N&&d==="all"&&h==="all"&&e.jsx("button",{onClick:()=>k(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Transaction"})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Add New Transaction"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier *"}),e.jsxs("select",{required:!0,value:w.supplier_id,onChange:l=>D({...w,supplier_id:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select supplier"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Type *"}),e.jsxs("select",{value:w.type,onChange:l=>D({...w,type:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"new_purchase",children:"New Purchase"}),e.jsx("option",{value:"pay_due",children:"Pay Due"}),e.jsx("option",{value:"settle_bill",children:"Settle Bill"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:w.amount,onChange:l=>D({...w,amount:l.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:w.description,onChange:l=>D({...w,description:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(X,{className:"inline h-4 w-4 mr-1"}),"Handled By"]}),e.jsxs("select",{value:w.owner_id,onChange:l=>D({...w,owner_id:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select who handled this transaction"}),x.map(l=>e.jsxs("option",{value:l.id,children:[l.owner_name," ",l.is_primary&&"(Primary)"," - ",l.role]},l.id))]})]}),w.type==="new_purchase"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:w.due_date,onChange:l=>D({...w,due_date:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Transaction"})]})]})]})})]})},Ps=()=>{const{user:r}=U(),[t,a]=i.useState({totalPurchases:0,totalPayments:0,netOutstanding:0,supplierBreakdown:[]}),[s,c]=i.useState([]),[x,f]=i.useState(!0),[C,E]=i.useState(""),[N,v]=i.useState("");i.useEffect(()=>{const g=new Date,k=new Date(g);k.setDate(g.getDate()-30),E(k.toISOString().split("T")[0]),v(g.toISOString().split("T")[0])},[]),i.useEffect(()=>{C&&N&&d()},[r,C,N]);const d=async()=>{if(r)try{f(!0);const{data:g,error:k}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name)
        `).eq("user_id",r.id).gte("created_at",C).lte("created_at",N+"T23:59:59").order("created_at",{ascending:!1});if(k)throw k;c(g||[]);const w=new Map;let D=0,S=0;g==null||g.forEach(b=>{var L;const T=((L=b.supplier)==null?void 0:L.name)||"Unknown",O=parseFloat(b.amount.toString());w.has(T)||w.set(T,{supplier:T,purchases:0,payments:0,outstanding:0});const B=w.get(T);b.type==="new_purchase"?(B.purchases+=O,D+=O,b.is_paid||(B.outstanding+=O)):(b.type==="pay_due"||b.type==="settle_bill")&&(B.payments+=O,S+=O,B.outstanding-=O),w.set(T,B)});const u=Array.from(w.values()).sort((b,T)=>T.outstanding-b.outstanding),o=u.reduce((b,T)=>b+T.outstanding,0);a({totalPurchases:D,totalPayments:S,netOutstanding:Math.max(0,o),supplierBreakdown:u})}catch(g){console.error("Error fetching report data:",g)}finally{f(!1)}},j=()=>{const g=["Date","Supplier","Type","Description","Amount","Status","Due Date"],k=s.map(o=>{var b;return[new Date(o.created_at).toLocaleDateString("en-IN"),((b=o.supplier)==null?void 0:b.name)||"Unknown",h(o.type),o.description,parseFloat(o.amount.toString()),o.is_paid?"Paid":"Unpaid",o.due_date?new Date(o.due_date).toLocaleDateString("en-IN"):""]}),w=[g.join(","),...k.map(o=>o.map(b=>`"${b}"`).join(","))].join(`
`),D=new Blob([w],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),u=URL.createObjectURL(D);S.setAttribute("href",u),S.setAttribute("download",`transactions-report-${C}-to-${N}.csv`),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)},h=g=>{switch(g){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return g}},p=g=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(g);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Analyze your supplier transactions and dues"})]}),e.jsxs("button",{onClick:j,disabled:s.length===0,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:C,onChange:g=>E(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:N,onChange:g=>v(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),s.length," transactions found"]})]})}),x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:p(t.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(as,{className:"h-6 w-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:p(t.totalPayments)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(ns,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Net Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p(t.netOutstanding)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ke,{className:"h-6 w-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Supplier Breakdown"}),e.jsx(ls,{className:"h-5 w-5 text-gray-400"})]}),t.supplierBreakdown.length>0?e.jsx("div",{className:"space-y-4",children:t.supplierBreakdown.map((g,k)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:g.supplier}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["Outstanding: ",p(g.outstanding)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"font-medium text-red-600",children:p(g.purchases)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"font-medium text-green-600",children:p(g.payments)})]})]})]},k))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No data available for the selected period"})]})]})]})]})};class Z{constructor(){this.isAuthenticated=!1,this.userEmail=""}static getInstance(){return Z.instance||(Z.instance=new Z),Z.instance}async initializeGoogleDrive(){console.log("Initializing Google Drive API...")}async authenticate(){try{return new Promise(t=>{setTimeout(()=>{this.isAuthenticated=!0,this.userEmail="user@gmail.com",t({success:!0,userEmail:this.userEmail})},2e3)})}catch(t){return console.error("Google Drive authentication failed:",t),{success:!1,userEmail:""}}}isConnected(){return this.isAuthenticated}getConnectedEmail(){return this.userEmail}async createBackup(t){try{return console.log("Creating backup on Google Drive...",t),new Promise(a=>{setTimeout(()=>{a({success:!0,fileId:`shopsynk-backup-${Date.now()}`})},3e3)})}catch(a){return console.error("Backup creation failed:",a),{success:!1}}}async scheduleAutoBackup(t){console.log("Auto backup scheduled for midnight daily");const a=new Date,s=new Date;s.setHours(24,0,0,0);const c=s.getTime()-a.getTime();setTimeout(()=>{t(),setInterval(t,24*60*60*1e3)},c)}disconnect(){this.isAuthenticated=!1,this.userEmail=""}}class ee{constructor(){this.googleDriveService=Z.getInstance()}static getInstance(){return ee.instance||(ee.instance=new ee),ee.instance}async exportUserData(t,a){try{const{data:s,error:c}=await y.from("suppliers").select("*").eq("user_id",t);if(c)throw c;const{data:x,error:f}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name, contact_person, phone, email)
        `).eq("user_id",t);if(f)throw f;return{suppliers:s||[],transactions:x||[],exportDate:new Date().toISOString(),userEmail:a}}catch(s){return console.error("Error exporting user data:",s),null}}async createBackup(t,a){try{if(!this.googleDriveService.isConnected())return{success:!1,message:"Google Drive not connected. Please connect first."};const s=await this.exportUserData(t,a);if(!s)return{success:!1,message:"Failed to export user data."};const c=await this.googleDriveService.createBackup(s);return c.success?(await this.recordBackup(t,c.fileId||"",s),{success:!0,message:"Backup created successfully on Google Drive!"}):{success:!1,message:"Failed to upload backup to Google Drive."}}catch(s){return console.error("Backup creation error:",s),{success:!1,message:"An error occurred during backup creation."}}}async recordBackup(t,a,s){try{await y.from("user_backups").insert([{user_id:t,backup_date:new Date().toISOString(),google_drive_file_id:a,suppliers_count:s.suppliers.length,transactions_count:s.transactions.length,backup_size:JSON.stringify(s).length,status:"completed"}])}catch(c){console.error("Error recording backup:",c)}}async setupAutoBackup(t,a){const s=async()=>{console.log("Running automatic backup...");const c=await this.createBackup(t,a);console.log("Auto backup result:",c.message),await this.sendBackupNotification(a,c.success)};await this.googleDriveService.scheduleAutoBackup(s)}async sendBackupNotification(t,a){console.log(`Backup notification sent to ${t}: ${a?"Success":"Failed"}`)}async getBackupHistory(t){try{const{data:a,error:s}=await y.from("user_backups").select("*").eq("user_id",t).order("backup_date",{ascending:!1}).limit(10);if(s)throw s;return a||[]}catch(a){return console.error("Error fetching backup history:",a),[]}}downloadBackupFile(t){const a=JSON.stringify(t,null,2),s=new Blob([a],{type:"application/json"}),c=URL.createObjectURL(s),x=document.createElement("a");x.href=c,x.download=`shopsynk-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c)}}const Es=()=>{const{user:r}=U(),[t,a]=i.useState({suppliersCount:0,transactionsCount:0,totalOutstanding:0,lastLogin:""}),[s,c]=i.useState(!0),[x,f]=i.useState({isConnected:!1,userEmail:"",lastBackup:"",autoBackupEnabled:!0}),[C,E]=i.useState([]),[N,v]=i.useState(!1),[d,j]=i.useState(!1),[h,p]=i.useState(""),g=ee.getInstance(),k=Z.getInstance(),w=Y.getInstance(),[D,S]=i.useState([]),[u,o]=i.useState([]),[b,T]=i.useState(!1),[O,B]=i.useState(null),[L,$]=i.useState({owner_name:"",role:"Owner"}),[l,A]=i.useState("");i.useEffect(()=>{le(),P(),H(),I()},[r]);const I=async()=>{var n;if(r)try{await w.ensurePrimaryOwner(r.id,r.email,(n=r.user_metadata)==null?void 0:n.full_name);const _=await w.getBusinessOwners(r.id);S(_);const R=await w.getOwnerStats(r.id);o(R)}catch(_){console.error("Error loading business owners:",_),A("Error loading business owners.")}},P=async()=>{if(r)try{const{data:n,error:_}=await y.from("user_settings").select("*").eq("user_id",r.id).single();if(_&&_.code!=="PGRST116")throw _;n&&f({isConnected:n.google_drive_connected||!1,userEmail:n.google_drive_email||"",lastBackup:n.last_backup_date||"",autoBackupEnabled:n.auto_backup_enabled||!0})}catch(n){console.error("Error loading Google Drive settings:",n)}},H=async()=>{if(r)try{const n=await g.getBackupHistory(r.id);E(n)}catch(n){console.error("Error loading backup history:",n)}},W=async()=>{v(!0),p("");try{const n=await k.authenticate();n.success?(await y.from("user_settings").upsert({user_id:r==null?void 0:r.id,google_drive_connected:!0,google_drive_email:n.userEmail,updated_at:new Date().toISOString()}),f(_=>({..._,isConnected:!0,userEmail:n.userEmail})),p("Successfully connected to Google Drive!"),await g.setupAutoBackup(r.id,r.email)):p("Failed to connect to Google Drive. Please try again.")}catch(n){console.error("Google Drive connection error:",n),p("An error occurred while connecting to Google Drive.")}finally{v(!1)}},oe=async()=>{try{k.disconnect(),await y.from("user_settings").upsert({user_id:r==null?void 0:r.id,google_drive_connected:!1,google_drive_email:null,updated_at:new Date().toISOString()}),f(n=>({...n,isConnected:!1,userEmail:""})),p("Disconnected from Google Drive.")}catch(n){console.error("Error disconnecting Google Drive:",n),p("Error disconnecting from Google Drive.")}},de=async()=>{if(r){j(!0),p("");try{const n=await g.createBackup(r.id,r.email);p(n.message),n.success&&(await H(),await P())}catch(n){console.error("Manual backup error:",n),p("An error occurred during backup.")}finally{j(!1)}}},J=async()=>{if(r)try{const n=await g.exportUserData(r.id,r.email);n?(g.downloadBackupFile(n),p("Backup file downloaded successfully!")):p("Failed to create backup file.")}catch(n){console.error("Download backup error:",n),p("Error creating backup file.")}},ne=async()=>{if(r)try{const n=!x.autoBackupEnabled;await y.from("user_settings").upsert({user_id:r.id,auto_backup_enabled:n,updated_at:new Date().toISOString()}),f(_=>({..._,autoBackupEnabled:n})),p(`Auto backup ${n?"enabled":"disabled"}.`)}catch(n){console.error("Error toggling auto backup:",n),p("Error updating auto backup setting.")}},ue=async n=>{if(n.preventDefault(),!!r)try{const _=await w.createBusinessOwner(r.id,L);_.success?(A("Owner added successfully!"),await I(),F()):A(`Error: ${_.error}`)}catch(_){console.error("Error adding owner:",_),A("An error occurred while adding the owner.")}},me=n=>{B(n),$({owner_name:n.owner_name,role:n.role}),T(!0)},xe=async n=>{if(n.preventDefault(),!!O)try{const _=await w.updateBusinessOwner(O.id,L);_.success?(A("Owner updated successfully!"),await I(),F()):A(`Error: ${_.error}`)}catch(_){console.error("Error updating owner:",_),A("An error occurred while updating the owner.")}},m=async n=>{if(confirm("Are you sure you want to remove this owner? This action cannot be undone."))try{const _=await w.deactivateBusinessOwner(n);_.success?(A("Owner removed successfully."),await I()):A(`Error: ${_.error}`)}catch(_){console.error("Error removing owner:",_),A("An error occurred while removing the owner.")}},F=()=>{$({owner_name:"",role:"Owner"}),B(null),T(!1)},G=n=>u.find(_=>_.owner_id===n)||{total_transactions:0,total_purchases:0,total_payments:0,total_purchase_amount:0,total_payment_amount:0},le=async()=>{if(r)try{const{count:n}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",r.id),{count:_}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",r.id),{data:R}=await y.from("transactions").select("type, amount, is_paid").eq("user_id",r.id);let z=0;R==null||R.forEach(q=>{q.type==="new_purchase"&&!q.is_paid?z+=parseFloat(q.amount.toString()):(q.type==="pay_due"||q.type==="settle_bill")&&(z-=parseFloat(q.amount.toString()))}),a({suppliersCount:n||0,transactionsCount:_||0,totalOutstanding:Math.max(0,z),lastLogin:r.last_sign_in_at||r.created_at||""})}catch(n){console.error("Error fetching user stats:",n)}finally{c(!1)}},he=n=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),K=n=>new Date(n).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your account settings and view activity"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Account Information"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ae,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Address"}),e.jsx("p",{className:"font-medium text-gray-900",children:r==null?void 0:r.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(is,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Status"}),e.jsx("p",{className:"font-medium text-green-600",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(se,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Created"}),e.jsx("p",{className:"font-medium text-gray-900",children:r!=null&&r.created_at?K(r.created_at):"N/A"})]})]}),t.lastLogin&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(se,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Sign In"}),e.jsx("p",{className:"font-medium text-gray-900",children:K(t.lastLogin)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Summary"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"h-6 w-6 text-green-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:t.suppliersCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:t.transactionsCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Outstanding Amount"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:he(t.totalOutstanding)})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Business Owners"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage owners and track their activities"})]})]}),e.jsxs("button",{onClick:()=>T(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Add Owner"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(n=>{const _=G(n.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:n.is_primary?e.jsx(os,{className:"h-5 w-5 text-yellow-500"}):e.jsx(re,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:n.owner_name}),e.jsx("p",{className:"text-sm text-gray-600",children:n.role}),n.is_primary&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full",children:"Primary"})]})]}),!n.is_primary&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>me(n),className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Edit owner",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(n.id),className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Remove owner",children:e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-blue-600 font-medium",children:_.total_purchases}),e.jsx("p",{className:"text-gray-500",children:"Purchases"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-green-600 font-medium",children:_.total_payments}),e.jsx("p",{className:"text-gray-500",children:"Payments"})]}),e.jsxs("div",{className:"col-span-2 text-center",children:[e.jsx("p",{className:"text-purple-600 font-medium",children:he(_.total_purchase_amount-_.total_payment_amount)}),e.jsx("p",{className:"text-gray-500",children:"Net Activity"})]})]})})]},n.id)})}),D.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No business owners found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add owners to track who handles transactions"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Google Drive Backup"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Pe,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[x.isConnected?e.jsx(fe,{className:"h-5 w-5 text-green-500"}):e.jsx(ye,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Connection Status"}),e.jsx("p",{className:`font-medium ${x.isConnected?"text-green-600":"text-red-600"}`,children:x.isConnected?"Connected":"Not Connected"}),x.isConnected&&x.userEmail&&e.jsx("p",{className:"text-xs text-gray-500",children:x.userEmail})]})]}),x.isConnected&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ds,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Auto Backup"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Daily at midnight"})]})]}),e.jsx("button",{onClick:ne,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${x.autoBackupEnabled?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x.autoBackupEnabled?"translate-x-6":"translate-x-1"}`})})]}),x.lastBackup&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(se,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Backup"}),e.jsx("p",{className:"font-medium text-gray-900",children:K(x.lastBackup)})]})]}),e.jsx("div",{className:"flex space-x-3",children:x.isConnected?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:de,disabled:d,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:bg-green-400 flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Backup Now"]})}),e.jsx("button",{onClick:oe,className:"px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors",children:"Disconnect"})]}):e.jsx("button",{onClick:W,disabled:N,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-400 flex items-center justify-center",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Connect Google Drive"]})})}),e.jsxs("button",{onClick:J,className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Download Local Backup"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Backup History"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(us,{className:"h-6 w-6 text-green-600"})})]}),e.jsx("div",{className:"space-y-3",children:C.length>0?C.slice(0,5).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n.status==="completed"?"bg-green-500":n.status==="failed"?"bg-red-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:K(n.backup_date)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[n.suppliers_count," suppliers, ",n.transactions_count," transactions"]})]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n.status==="completed"?"bg-green-100 text-green-700":n.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:n.status})]},n.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No backups yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Connect Google Drive to start automatic backups"})]})})]})]}),h&&e.jsx("div",{className:`border rounded-lg p-4 ${h.includes("Success")||h.includes("successfully")?"bg-green-50 border-green-200":h.includes("Error")||h.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[h.includes("Success")||h.includes("successfully")?e.jsx(fe,{className:"h-5 w-5 text-green-600 mt-0.5"}):h.includes("Error")||h.includes("Failed")?e.jsx(ye,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(je,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${h.includes("Success")||h.includes("successfully")?"text-green-800":h.includes("Error")||h.includes("Failed")?"text-red-800":"text-blue-800"}`,children:h})})]})}),l&&e.jsx("div",{className:`border rounded-lg p-4 ${l.includes("Success")||l.includes("successfully")?"bg-green-50 border-green-200":l.includes("Error")||l.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[l.includes("Success")||l.includes("successfully")?e.jsx(fe,{className:"h-5 w-5 text-green-600 mt-0.5"}):l.includes("Error")||l.includes("Failed")?e.jsx(ye,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(je,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${l.includes("Success")||l.includes("successfully")?"text-green-800":l.includes("Error")||l.includes("Failed")?"text-red-800":"text-blue-800"}`,children:l})})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:O?"Edit Owner":"Add New Owner"}),e.jsxs("form",{onSubmit:O?xe:ue,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Owner Name *"}),e.jsx("input",{type:"text",required:!0,value:L.owner_name,onChange:n=>$({...L,owner_name:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter owner's full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role/Title"}),e.jsx("input",{type:"text",value:L.role,onChange:n=>$({...L,role:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"e.g., Owner, Partner, Manager"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:F,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:O?"Update Owner":"Add Owner"})]})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(je,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Your data is securely stored and encrypted. Always sign out when using shared devices. If you notice any unusual activity, please contact support immediately."})]})]})})]})};function Os(){return e.jsx(js,{children:e.jsx(We,{children:e.jsx("div",{className:"App",children:e.jsxs(Ce,{children:[e.jsx(M,{path:"/login",element:e.jsx(vs,{})}),e.jsx(M,{path:"/register",element:e.jsx(_s,{})}),e.jsx(M,{path:"/*",element:e.jsx(ws,{children:e.jsx(Ns,{children:e.jsxs(Ce,{children:[e.jsx(M,{path:"/",element:e.jsx(Ss,{})}),e.jsx(M,{path:"/suppliers",element:e.jsx(Cs,{})}),e.jsx(M,{path:"/suppliers/:id",element:e.jsx(Ds,{})}),e.jsx(M,{path:"/transactions",element:e.jsx(ks,{})}),e.jsx(M,{path:"/reports",element:e.jsx(Ps,{})}),e.jsx(M,{path:"/profile",element:e.jsx(Es,{})}),e.jsx(M,{path:"*",element:e.jsx(Ae,{to:"/",replace:!0})})]})})})})]})})})})}Ge(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Os,{})}));
