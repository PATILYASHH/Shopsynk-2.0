import{r as i,a as Je,N as Ie,u as re,b as Ve,R as Ye,L as Fe,d as Ze,B as Xe,e as Pe,f as $}from"./vendor-DsmcgGc9.js";import{c as Qe}from"./supabase-6T48ApRq.js";import{X as ue,D as xe,R as V,M as es,U as ae,L as ss,H as ts,a as H,b as G,F as rs,c as Le,d as ne,e as _e,E as Se,f as me,A as Ue,P as ke,g as se,T as Ee,h as De,i as Ce,S as Re,j as $e,k as qe,l as Me,m as ze,n as as,C as we,o as Ne,p as te,q as ns,r as ls,s as is,t as Oe,u as cs,v as Be,w as ce,x as os,y as oe,z as de,B as ds,G as us,I as ms,J as Te,K as ve,N as xs,O as hs}from"./ui-DtYMGZIt.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();var Ge={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ps=i,gs=Symbol.for("react.element"),bs=Symbol.for("react.fragment"),fs=Object.prototype.hasOwnProperty,ys=ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,js={key:!0,ref:!0,__self:!0,__source:!0};function Ke(t,s,n){var r,o={},u=null,g=null;n!==void 0&&(u=""+n),s.key!==void 0&&(u=""+s.key),s.ref!==void 0&&(g=s.ref);for(r in s)fs.call(s,r)&&!js.hasOwnProperty(r)&&(o[r]=s[r]);if(t&&t.defaultProps)for(r in s=t.defaultProps,s)o[r]===void 0&&(o[r]=s[r]);return{$$typeof:gs,type:t,key:u,ref:g,props:o,_owner:ys.current}}he.Fragment=bs;he.jsx=Ke;he.jsxs=Ke;Ge.exports=he;var e=Ge.exports,We,Ae=Je;We=Ae.createRoot,Ae.hydrateRoot;const ws="https://gxgiqmmlvdgrzvbgmgfp.supabase.co",Ns="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4Z2lxbW1sdmRncnp2YmdtZ2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTA4OTEsImV4cCI6MjA3MTY2Njg5MX0.VzO5yGWCFpN6ZU7d76tK9ADFPNwukuQ96RD3iILpAg0",y=Qe(ws,Ns),He=i.createContext(void 0),q=()=>{const t=i.useContext(He);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},vs=({children:t})=>{const[s,n]=i.useState(null),[r,o]=i.useState(!0);i.useEffect(()=>{y.auth.getUser().then(({data:{user:N}})=>{n(N),o(!1)});const{data:{subscription:w}}=y.auth.onAuthStateChange((N,d)=>{n((d==null?void 0:d.user)??null),o(!1)});return()=>w.unsubscribe()},[]);const O={user:s,loading:r,signUp:async(w,N)=>{const{data:d,error:b}=await y.auth.signUp({email:w,password:N});return{data:d,error:b}},signIn:async(w,N)=>{const{data:d,error:b}=await y.auth.signInWithPassword({email:w,password:N});return{data:d,error:b}},signOut:async()=>{const{error:w}=await y.auth.signOut();if(w)throw w}};return e.jsx(He.Provider,{value:O,children:t})},_s=({children:t})=>{const{user:s,loading:n}=q();return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(Ie,{to:"/login",replace:!0})},Ss=()=>{const[t,s]=i.useState(null),[n,r]=i.useState(!1),[o,u]=i.useState(!1),[g,S]=i.useState(!1);i.useEffect(()=>{const N=/iPad|iPhone|iPod/.test(navigator.userAgent);u(N);const d=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");S(d);const b=h=>{h.preventDefault(),s(h),r(!0)};return window.addEventListener("beforeinstallprompt",b),()=>{window.removeEventListener("beforeinstallprompt",b)}},[]);const O=async()=>{if(!t)return;t.prompt();const{outcome:N}=await t.userChoice;console.log(N==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),s(null),r(!1)},w=()=>{r(!1),sessionStorage.setItem("installPromptDismissed","true")};return g||sessionStorage.getItem("installPromptDismissed")==="true"?null:o&&!g?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 bg-blue-600 text-white p-4 rounded-lg shadow-lg border border-blue-500",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Install Shopsynk"}),e.jsxs("p",{className:"text-xs mt-1 opacity-90",children:["Install this app on your iPhone: tap ",e.jsx("span",{className:"font-bold",children:"Share"})," and then ",e.jsx("span",{className:"font-bold",children:"Add to Home Screen"})]})]}),e.jsx("button",{onClick:w,className:"ml-2 p-1 hover:bg-blue-700 rounded",children:e.jsx(ue,{className:"h-4 w-4"})})]})}):n&&t?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg shadow-lg border border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(xe,{className:"h-5 w-5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Install Shopsynk App"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Get the full app experience with offline access and notifications"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:O,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-medium hover:bg-gray-100 transition-colors",children:"Install"}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-blue-700 rounded",children:e.jsx(ue,{className:"h-4 w-4"})})]})]})}):null},ks=()=>{const[t,s]=i.useState(!1),[n,r]=i.useState(null);i.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(g=>{g.waiting&&(r(g.waiting),s(!0)),g.addEventListener("updatefound",()=>{const S=g.installing;S&&S.addEventListener("statechange",()=>{S.state==="installed"&&navigator.serviceWorker.controller&&(r(S),s(!0))})})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))},[]);const o=()=>{n&&(n.postMessage({type:"SKIP_WAITING"}),s(!1))},u=()=>{s(!1)};return t?e.jsx("div",{className:"fixed top-4 left-4 right-4 z-50 bg-green-600 text-white p-4 rounded-lg shadow-lg border border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(V,{className:"h-5 w-5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"App Update Available"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"A new version of Shopsynk is ready to install"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:o,className:"bg-white text-green-600 px-3 py-1 rounded text-xs font-medium hover:bg-gray-100 transition-colors",children:"Update"}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-green-700 rounded",children:e.jsx(ue,{className:"h-4 w-4"})})]})]})}):null},Ds=({children:t})=>{const{user:s,signOut:n}=q(),r=re(),o=Ve(),[u,g]=Ye.useState(!1),S=async()=>{try{await n(),r("/login")}catch(N){console.error("Error signing out:",N)}},O=[{name:"Dashboard",path:"/",icon:ts},{name:"Suppliers",path:"/suppliers",icon:H},{name:"Transactions",path:"/transactions",icon:G},{name:"Reports",path:"/reports",icon:rs},{name:"Data Storage",path:"/data-storage",icon:Le},{name:"Profile",path:"/profile",icon:ae}],w=N=>N==="/"?o.pathname==="/":o.pathname.startsWith(N);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:e.jsx("button",{onClick:()=>g(!u),className:"bg-white p-2 rounded-lg shadow-md border border-gray-200 hover:bg-gray-50 transition-colors",children:u?e.jsx(ue,{className:"h-6 w-6"}):e.jsx(es,{className:"h-6 w-6"})})}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg border-r border-gray-200 transform transition-transform duration-200 ease-in-out lg:translate-x-0 ${u?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-center h-16 bg-blue-600 text-white",children:e.jsx("h1",{className:"text-xl font-bold",children:"Shopsynk"})}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:O.map(N=>{const d=N.icon;return e.jsxs("button",{onClick:()=>{r(N.path),g(!1)},className:`w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ${w(N.path)?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(d,{className:"h-5 w-5 mr-3"}),N.name]},N.name)})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"h-4 w-4 text-blue-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s==null?void 0:s.email})})]}),e.jsx("button",{onClick:S,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",title:"Sign out",children:e.jsx(ss,{className:"h-4 w-4"})})]})})]})}),e.jsx("div",{className:"lg:pl-64",children:e.jsx("main",{className:"p-6 lg:p-8",children:t})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>g(!1)}),e.jsx(Ss,{}),e.jsx(ks,{})]})},Cs=()=>{const[t,s]=i.useState(""),[n,r]=i.useState(""),[o,u]=i.useState(!1),[g,S]=i.useState(!1),[O,w]=i.useState(""),{signIn:N}=q(),d=re(),b=async h=>{h.preventDefault(),S(!0),w("");try{const{error:f}=await N(t,n);if(f)throw f;d("/")}catch(f){w(f.message)}finally{S(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sign in to manage your supplier dues"})]}),O&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:O}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:h=>s(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:o?"text":"password",value:n,onChange:h=>r(h.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your password",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?e.jsx(Se,{className:"h-5 w-5"}):e.jsx(me,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:g?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Sign In",e.jsx(Ue,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(Fe,{to:"/register",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Create one"})]})})]})})})},Ps=()=>{const[t,s]=i.useState(""),[n,r]=i.useState(""),[o,u]=i.useState(""),[g,S]=i.useState(!1),[O,w]=i.useState(!1),[N,d]=i.useState(!1),[b,h]=i.useState(""),[f,j]=i.useState(""),{signUp:T}=q(),v=re(),B=async k=>{if(k.preventDefault(),d(!0),h(""),j(""),n!==o){h("Passwords do not match"),d(!1);return}try{const{error:m}=await T(t,n);if(m)throw m;j("Account created successfully! You can now sign in."),setTimeout(()=>v("/login"),2e3)}catch(m){h(m.message)}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Start managing your supplier dues today"})]}),b&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:b}),f&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-600 text-sm",children:f}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:k=>s(k.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:g?"text":"password",value:n,onChange:k=>r(k.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Create a password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>S(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?e.jsx(Se,{className:"h-5 w-5"}):e.jsx(me,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:O?"text":"password",value:o,onChange:k=>u(k.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Confirm your password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>w(!O),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:O?e.jsx(Se,{className:"h-5 w-5"}):e.jsx(me,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:N,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:N?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Create Account",e.jsx(Ue,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(Fe,{to:"/login",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})})]})})})},Es=()=>{const{user:t}=q(),s=re(),[n,r]=i.useState({totalDues:0,totalSuppliers:0,totalTransactions:0,pendingPayments:0,recentTransactions:[],upcomingDues:[]}),[o,u]=i.useState(!0);i.useEffect(()=>{g()},[t]);const g=async()=>{if(t)try{const{count:d}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:b}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:h}=await y.from("transactions").select("*").eq("user_id",t.id),f=new Map;h==null||h.forEach(a=>{const p=a.supplier_id;f.has(p)||f.set(p,0),a.type==="new_purchase"?f.set(p,f.get(p)+parseFloat(a.amount)):(a.type==="pay_due"||a.type==="settle_bill")&&f.set(p,f.get(p)-parseFloat(a.amount))});let j=0,T=0;f.forEach(a=>{a>.01&&(j+=a,T++)});const{data:v}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1}).limit(5),{data:B}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1}),k=new Map;B==null||B.forEach(a=>{var C;const p=a.supplier_id,P=(C=a.supplier)==null?void 0:C.name;k.has(p)||k.set(p,{supplier_id:p,supplier_name:P,balance:0,lastTransaction:a,dueDate:null});const _=k.get(p);a.type==="new_purchase"?(_.balance+=parseFloat(a.amount),a.due_date&&(!_.dueDate||a.due_date<_.dueDate)&&(_.dueDate=a.due_date)):(a.type==="pay_due"||a.type==="settle_bill")&&(_.balance-=parseFloat(a.amount))});const m=Array.from(k.values()).filter(a=>a.balance>.01).map(a=>({id:`outstanding-${a.supplier_id}`,supplier_id:a.supplier_id,supplier:{name:a.supplier_name},amount:a.balance.toFixed(2),description:"Outstanding balance",due_date:a.dueDate,type:"outstanding"})).sort((a,p)=>a.due_date&&!p.due_date?-1:!a.due_date&&p.due_date?1:a.due_date&&p.due_date&&a.due_date!==p.due_date?a.due_date.localeCompare(p.due_date):parseFloat(p.amount)-parseFloat(a.amount)).slice(0,10);r({totalDues:Math.max(0,j),totalSuppliers:d||0,totalTransactions:b||0,pendingPayments:T,recentTransactions:v||[],upcomingDues:m||[]})}catch(d){console.error("Error fetching dashboard data:",d)}finally{u(!1)}},S=d=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),O=d=>new Date(d).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),w=d=>{switch(d){case"new_purchase":return e.jsx(Ce,{className:"h-4 w-4 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(De,{className:"h-4 w-4 text-green-500"});default:return e.jsx(G,{className:"h-4 w-4 text-gray-500"})}},N=d=>{switch(d){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return d}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Welcome back! Here's your business overview."})]}),e.jsxs("button",{onClick:()=>s("/transactions/new"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:S(n.totalDues)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"h-6 w-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalSuppliers})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalTransactions})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Payments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.pendingPayments})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center",children:e.jsx(Ee,{className:"h-6 w-6 text-yellow-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"}),e.jsx("button",{onClick:()=>s("/transactions"),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-4",children:n.recentTransactions.length>0?n.recentTransactions.map(d=>{var b,h;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>s(`/suppliers/${d.supplier_id}`),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[w(d.type),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(b=d.supplier)==null?void 0:b.name}),e.jsx("p",{className:"text-sm text-gray-600",children:N(d.type)}),((h=d.owner)==null?void 0:h.owner_name)&&e.jsxs("p",{className:"text-xs text-blue-600",children:[d.type==="new_purchase"?"Purchased by: ":"Paid by: ",d.owner.owner_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-medium ${d.type==="new_purchase"?"text-red-600":"text-green-600"}`,children:[d.type==="new_purchase"?"+":"-",S(parseFloat(d.amount))]}),e.jsx("p",{className:"text-sm text-gray-500",children:O(d.created_at)})]})]},d.id)}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No transactions yet"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Outstanding Payments"}),e.jsx(Ee,{className:"h-5 w-5 text-orange-400"})]}),e.jsx("div",{className:"space-y-4",children:n.upcomingDues.length>0?n.upcomingDues.map(d=>{var b;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition-colors cursor-pointer",onClick:()=>s(`/suppliers/${d.supplier_id}`),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(b=d.supplier)==null?void 0:b.name}),e.jsx("p",{className:"text-sm text-gray-600",children:d.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-red-600",children:S(parseFloat(d.amount))}),e.jsx("p",{className:"text-sm text-gray-500",children:d.due_date?`Due: ${O(d.due_date)}`:"No due date"})]})]},d.id)}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No outstanding payments"})})]})]})]})},Os=()=>{const{user:t}=q(),s=re(),[n,r]=i.useState([]),[o,u]=i.useState(!0),[g,S]=i.useState(""),[O,w]=i.useState(!1),[N,d]=i.useState(null),[b,h]=i.useState({name:"",contact_person:"",phone:"",email:"",address:""});i.useEffect(()=>{f()},[t]);const f=async()=>{if(t)try{const{data:m,error:a}=await y.from("suppliers").select("*").eq("user_id",t.id).order("name");if(a)throw a;r(m||[])}catch(m){console.error("Error fetching suppliers:",m)}finally{u(!1)}},j=async m=>{if(m.preventDefault(),!!t)try{if(N){const{error:a}=await y.from("suppliers").update(b).eq("id",N.id).eq("user_id",t.id);if(a)throw a}else{const{error:a}=await y.from("suppliers").insert([{...b,user_id:t.id}]);if(a)throw a}await f(),B()}catch(a){console.error("Error saving supplier:",a)}},T=m=>{d(m),h({name:m.name,contact_person:m.contact_person||"",phone:m.phone||"",email:m.email||"",address:m.address||""}),w(!0)},v=async m=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:a}=await y.from("suppliers").delete().eq("id",m).eq("user_id",t.id);if(a)throw a;await f()}catch(a){console.error("Error deleting supplier:",a)}},B=()=>{h({name:"",contact_person:"",phone:"",email:"",address:""}),d(null),w(!1)},k=n.filter(m=>m.name.toLowerCase().includes(g.toLowerCase())||m.contact_person&&m.contact_person.toLowerCase().includes(g.toLowerCase()));return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Suppliers"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your supplier relationships"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:g,onChange:m=>S(m.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(m=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:m.name}),m.contact_person&&e.jsx("p",{className:"text-sm text-gray-600",children:m.contact_person})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>s(`/suppliers/${m.id}`),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",title:"View details",children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(m),className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50",title:"Edit supplier",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>v(m.id),className:"p-2 text-gray-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:"Delete supplier",children:e.jsx(qe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[m.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{children:m.phone})]}),m.email&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:m.email})]}),m.address&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"line-clamp-2",children:m.address})]})]})]},m.id))}),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:g?"No suppliers found":"No suppliers yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:g?"Try adjusting your search terms.":"Start by adding your first supplier to begin tracking dues."}),!g&&e.jsx("button",{onClick:()=>w(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Supplier"})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:N?"Edit Supplier":"Add New Supplier"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",required:!0,value:b.name,onChange:m=>h({...b,name:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",value:b.contact_person,onChange:m=>h({...b,contact_person:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:b.phone,onChange:m=>h({...b,phone:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:b.email,onChange:m=>h({...b,email:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:b.address,onChange:m=>h({...b,address:m.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter address"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[N?"Update":"Create"," Supplier"]})]})]})]})})]})};class Y{static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}async getBusinessOwners(s){try{const{data:n,error:r}=await y.from("business_owners").select("*").eq("user_id",s).eq("is_active",!0).order("is_primary",{ascending:!1}).order("created_at",{ascending:!0});if(r)throw r;return n||[]}catch(n){return console.error("Error fetching business owners:",n),[]}}async getPrimaryOwner(s){try{const{data:n,error:r}=await y.from("business_owners").select("*").eq("user_id",s).eq("is_primary",!0).eq("is_active",!0).single();if(r&&r.code!=="PGRST116")throw r;return n||null}catch(n){return console.error("Error fetching primary owner:",n),null}}async createBusinessOwner(s,n){try{const{data:r,error:o}=await y.from("business_owners").insert([{user_id:s,owner_name:n.owner_name,role:n.role||"Owner",is_primary:!1,is_active:!0}]).select().single();if(o)throw o;return{success:!0,data:r}}catch(r){return console.error("Error creating business owner:",r),{success:!1,error:r.message||"Failed to create business owner"}}}async updateBusinessOwner(s,n){try{const{data:r,error:o}=await y.from("business_owners").update({owner_name:n.owner_name,role:n.role,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(o)throw o;return{success:!0,data:r}}catch(r){return console.error("Error updating business owner:",r),{success:!1,error:r.message||"Failed to update business owner"}}}async deactivateBusinessOwner(s){try{const{data:n,error:r}=await y.from("business_owners").select("is_primary").eq("id",s).single();if(r)throw r;if(n.is_primary)return{success:!1,error:"Cannot deactivate the primary owner"};const{error:o}=await y.from("business_owners").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",s);if(o)throw o;return{success:!0}}catch(n){return console.error("Error deactivating business owner:",n),{success:!1,error:n.message||"Failed to deactivate business owner"}}}async getOwnerStats(s){try{const{data:n,error:r}=await y.from("owner_transaction_stats").select("*").eq("user_id",s);if(r)throw r;return n||[]}catch(n){return console.error("Error fetching owner stats:",n),[]}}async ensurePrimaryOwner(s,n,r){try{const o=await this.getPrimaryOwner(s);if(o)return o;const u=await this.createBusinessOwner(s,{owner_name:r||n.split("@")[0],role:"Primary Owner",is_primary:!0});return u.success?u.data:null}catch(o){return console.error("Error ensuring primary owner:",o),null}}async updateTransactionOwner(s,n){try{const{error:r}=await y.from("transactions").update({owner_id:n}).eq("id",s);if(r)throw r;return{success:!0}}catch(r){return console.error("Error updating transaction owner:",r),{success:!1,error:r.message||"Failed to update transaction owner"}}}async updateSupplierOwner(s,n){try{const{error:r}=await y.from("suppliers").update({added_by_owner_id:n}).eq("id",s);if(r)throw r;return{success:!0}}catch(r){return console.error("Error updating supplier owner:",r),{success:!1,error:r.message||"Failed to update supplier owner"}}}}const Bs=()=>{const{id:t}=Ze(),{user:s}=q(),n=re(),[r,o]=i.useState(null),[u,g]=i.useState([]),[S,O]=i.useState([]),[w,N]=i.useState(!0),[d,b]=i.useState(!1),[h,f]=i.useState(!1),[j,T]=i.useState(""),[v,B]=i.useState(""),[k,m]=i.useState(""),[a,p]=i.useState(""),[P,_]=i.useState(""),[C,E]=i.useState(""),[U,l]=i.useState(""),[I,F]=i.useState(0),[A,M]=i.useState({totalPurchases:0,totalPaid:0,totalDue:0,transactionCount:0});i.useEffect(()=>{t&&Z()},[t,s]);const Z=async()=>{if(!(!s||!t))try{const{data:x,error:L}=await y.from("suppliers").select("*").eq("id",t).eq("user_id",s.id).single();if(L)throw L;const{data:K,error:ie}=await y.from("transactions").select(`
          *,
          owner:business_owners(owner_name)
        `).eq("supplier_id",t).eq("user_id",s.id).order("created_at",{ascending:!1});if(ie)throw ie;const ee=await Y.getInstance().getBusinessOwners(s.id);o(x),g(K||[]),O(ee||[]);let c=0,D=0,z=0;K==null||K.forEach(W=>{const R=parseFloat(W.amount.toString());W.type==="new_purchase"?(c+=R,W.is_paid||(z+=R)):(W.type==="pay_due"||W.type==="settle_bill")&&(D+=R,z-=R)}),F(Math.max(0,z)),M({totalPurchases:c,totalPaid:D,totalDue:Math.max(0,z),transactionCount:(K==null?void 0:K.length)||0})}catch(x){console.error("Error fetching supplier data:",x)}finally{N(!1)}},pe=async x=>{if(x.preventDefault(),!(!s||!t||!j))try{const{error:L}=await y.from("transactions").insert([{user_id:s.id,supplier_id:t,type:"pay_due",amount:parseFloat(j),description:U||"Payment made",is_paid:!0,owner_id:v||null}]);if(L)throw L;await Z(),b(!1),T(""),B(""),l("")}catch(L){console.error("Error processing payment:",L)}},ge=async x=>{if(x.preventDefault(),!(!s||!t||!k))try{const{error:L}=await y.from("transactions").insert([{user_id:s.id,supplier_id:t,type:"new_purchase",amount:parseFloat(k),description:P||"New purchase",due_date:C||null,is_paid:!1,owner_id:a||null}]);if(L)throw L;await Z(),f(!1),m(""),p(""),_(""),E("")}catch(L){console.error("Error adding purchase:",L)}},J=x=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(x),le=x=>new Date(x).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),be=x=>{switch(x){case"new_purchase":return e.jsx(Ce,{className:"h-5 w-5 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(De,{className:"h-5 w-5 text-green-500"});default:return e.jsx(G,{className:"h-5 w-5 text-gray-500"})}},fe=x=>{switch(x){case"new_purchase":return"Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return x}},ye=x=>{switch(x){case"new_purchase":return"text-red-600";case"pay_due":case"settle_bill":return"text-green-600";default:return"text-gray-600"}};return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>n("/suppliers"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(as,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:r.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Supplier Details & Transaction History"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>b(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:J(A.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Paid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:J(A.totalPaid)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Outstanding Due"}),e.jsx("p",{className:`text-2xl font-bold ${A.totalDue>0?"text-red-600":"text-gray-400"}`,children:J(A.totalDue)})]}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${A.totalDue>0?"bg-red-100":"bg-gray-100"}`,children:e.jsx(se,{className:`h-6 w-6 ${A.totalDue>0?"text-red-600":"text-gray-400"}`})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.transactionCount})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"h-6 w-6 text-gray-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r.name}),r.contact_person&&e.jsx("p",{className:"text-gray-600",children:r.contact_person})]})]}),e.jsxs("div",{className:"space-y-4",children:[r.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Me,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:r.phone})]}),r.email&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:r.email})]}),r.address&&e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ze,{className:"h-5 w-5 text-gray-400 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:r.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Status"}),e.jsx(se,{className:"h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Rate"}),e.jsx("span",{className:"text-sm font-medium",children:A.totalPurchases>0?`${Math.round(A.totalPaid/A.totalPurchases*100)}%`:"0%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:A.totalPurchases>0?`${Math.min(A.totalPaid/A.totalPurchases*100,100)}%`:"0%"}})}),e.jsxs("div",{className:"text-center pt-2",children:[e.jsx("p",{className:`text-2xl font-bold ${A.totalDue>0?"text-red-600":"text-green-600"}`,children:A.totalDue>0?J(A.totalDue):"All Clear!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:A.totalDue>0?"Outstanding Balance":"No pending dues"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transaction History"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>b(!0),className:"bg-green-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"New Purchase"]})]})]})}),e.jsx("div",{className:"p-6",children:u.length>0?e.jsx("div",{className:"space-y-4",children:u.map(x=>{var L;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[be(x.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:fe(x.type)}),!x.is_paid&&x.type==="new_purchase"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"Unpaid"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:x.description}),((L=x.owner)==null?void 0:L.owner_name)&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[x.type==="new_purchase"?"Purchased by: ":"Paid by: ",x.owner.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),le(x.created_at)]}),x.due_date&&e.jsxs("span",{children:["Due: ",le(x.due_date)]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`text-lg font-semibold ${ye(x.type)}`,children:[x.type==="new_purchase"?"+":"-",J(parseFloat(x.amount.toString()))]})})]})},x.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet with this supplier"})]})})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["Pay Due to ",r.name]}),e.jsxs("form",{onSubmit:pe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:j,onChange:x=>T(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter payment amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:U,onChange:x=>l(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Payment description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Made By"}),e.jsxs("select",{value:v,onChange:x=>B(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select who made this payment"}),S.map(x=>e.jsxs("option",{value:x.id,children:[x.owner_name," ",x.is_primary&&"(Primary)"," - ",x.role]},x.id))]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:["Current outstanding: ",e.jsx("span",{className:"font-medium",children:J(I)})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Process Payment"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["New Purchase from ",r.name]}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:k,onChange:x=>m(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter purchase amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:P,onChange:x=>_(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Purchase description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Made By"}),e.jsxs("select",{value:a,onChange:x=>p(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select who made this purchase"}),S.map(x=>e.jsxs("option",{value:x.id,children:[x.owner_name," ",x.is_primary&&"(Primary)"," - ",x.role]},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:C,onChange:x=>E(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Purchase"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Supplier not found"}),e.jsx("button",{onClick:()=>n("/suppliers"),className:"text-blue-600 hover:text-blue-700",children:"Back to Suppliers"})]})},Ts=()=>{const{user:t}=q(),[s,n]=i.useState([]),[r,o]=i.useState([]),[u,g]=i.useState([]),[S,O]=i.useState(!0),[w,N]=i.useState(""),[d,b]=i.useState("all"),[h,f]=i.useState("all"),[j,T]=i.useState(!1),[v,B]=i.useState({supplier_id:"",type:"new_purchase",amount:"",description:"",due_date:"",is_paid:!1,owner_id:""});i.useEffect(()=>{k()},[t]);const k=async()=>{if(t)try{const{data:l,error:I}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1});if(I)throw I;const{data:F,error:A}=await y.from("suppliers").select("*").eq("user_id",t.id).order("name");if(A)throw A;const Z=await Y.getInstance().getBusinessOwners(t.id);n(l||[]),o(F||[]),g(Z||[])}catch(l){console.error("Error fetching data:",l)}finally{O(!1)}},m=async l=>{if(l.preventDefault(),!!t)try{const I={...v,user_id:t.id,amount:parseFloat(v.amount),due_date:v.due_date||null,owner_id:v.owner_id||null},{error:F}=await y.from("transactions").insert([I]);if(F)throw F;await k(),a()}catch(I){console.error("Error creating transaction:",I)}},a=()=>{B({supplier_id:"",type:"new_purchase",amount:"",description:"",due_date:"",is_paid:!1,owner_id:""}),T(!1)},p=s.filter(l=>{var M;const I=((M=l.supplier)==null?void 0:M.name.toLowerCase().includes(w.toLowerCase()))||l.description.toLowerCase().includes(w.toLowerCase()),F=d==="all"||l.type===d,A=h==="all"||h==="paid"&&l.is_paid||h==="unpaid"&&!l.is_paid;return I&&F&&A}),P=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),_=l=>new Date(l).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),C=l=>{switch(l){case"new_purchase":return e.jsx(Ce,{className:"h-5 w-5 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(De,{className:"h-5 w-5 text-green-500"});default:return e.jsx(G,{className:"h-5 w-5 text-gray-500"})}},E=l=>{switch(l){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return l}},U=l=>{switch(l){case"new_purchase":return"text-red-600";case"pay_due":case"settle_bill":return"text-green-600";default:return"text-gray-600"}};return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Transactions"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track all your supplier transactions"})]}),e.jsxs("button",{onClick:()=>T(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:w,onChange:l=>N(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("select",{value:d,onChange:l=>b(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"new_purchase",children:"New Purchase"}),e.jsx("option",{value:"pay_due",children:"Payment"}),e.jsx("option",{value:"settle_bill",children:"Settlement"})]}),e.jsxs("select",{value:h,onChange:l=>f(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"unpaid",children:"Unpaid"})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),p.length," transactions"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:p.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:p.map(l=>{var I,F;return e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:C(l.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:(I=l.supplier)==null?void 0:I.name}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full",children:E(l.type)}),!l.is_paid&&l.type==="new_purchase"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"Unpaid"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:l.description}),((F=l.owner)==null?void 0:F.owner_name)&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[l.type==="new_purchase"?"Purchased by: ":"Paid by: ",l.owner.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),_(l.created_at)]}),l.due_date&&e.jsxs("span",{className:"flex items-center",children:["Due: ",_(l.due_date)]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`text-lg font-semibold ${U(l.type)}`,children:[l.type==="new_purchase"?"+":"-",P(parseFloat(l.amount.toString()))]})})]})},l.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:w||d!=="all"||h!=="all"?"No transactions found":"No transactions yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:w||d!=="all"||h!=="all"?"Try adjusting your search or filters.":"Start by adding your first transaction."}),!w&&d==="all"&&h==="all"&&e.jsx("button",{onClick:()=>T(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Transaction"})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Add New Transaction"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier *"}),e.jsxs("select",{required:!0,value:v.supplier_id,onChange:l=>B({...v,supplier_id:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select supplier"}),r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Type *"}),e.jsxs("select",{value:v.type,onChange:l=>B({...v,type:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"new_purchase",children:"New Purchase"}),e.jsx("option",{value:"pay_due",children:"Pay Due"}),e.jsx("option",{value:"settle_bill",children:"Settle Bill"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:v.amount,onChange:l=>B({...v,amount:l.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:v.description,onChange:l=>B({...v,description:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(H,{className:"inline h-4 w-4 mr-1"}),"Handled By"]}),e.jsxs("select",{value:v.owner_id,onChange:l=>B({...v,owner_id:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select who handled this transaction"}),u.map(l=>e.jsxs("option",{value:l.id,children:[l.owner_name," ",l.is_primary&&"(Primary)"," - ",l.role]},l.id))]})]}),v.type==="new_purchase"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:v.due_date,onChange:l=>B({...v,due_date:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Transaction"})]})]})]})})]})},As=()=>{const{user:t}=q(),[s,n]=i.useState({totalPurchases:0,totalPayments:0,netOutstanding:0,supplierBreakdown:[]}),[r,o]=i.useState([]),[u,g]=i.useState(!0),[S,O]=i.useState(""),[w,N]=i.useState("");i.useEffect(()=>{const j=new Date,T=new Date(j);T.setDate(j.getDate()-30),O(T.toISOString().split("T")[0]),N(j.toISOString().split("T")[0])},[]),i.useEffect(()=>{S&&w&&d()},[t,S,w]);const d=async()=>{if(t)try{g(!0);const{data:j,error:T}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name)
        `).eq("user_id",t.id).gte("created_at",S).lte("created_at",w+"T23:59:59").order("created_at",{ascending:!1});if(T)throw T;o(j||[]);const v=new Map;let B=0,k=0;j==null||j.forEach(p=>{var E;const P=((E=p.supplier)==null?void 0:E.name)||"Unknown",_=parseFloat(p.amount.toString());v.has(P)||v.set(P,{supplier:P,purchases:0,payments:0,outstanding:0});const C=v.get(P);p.type==="new_purchase"?(C.purchases+=_,B+=_,p.is_paid||(C.outstanding+=_)):(p.type==="pay_due"||p.type==="settle_bill")&&(C.payments+=_,k+=_,C.outstanding-=_),v.set(P,C)});const m=Array.from(v.values()).sort((p,P)=>P.outstanding-p.outstanding),a=m.reduce((p,P)=>p+P.outstanding,0);n({totalPurchases:B,totalPayments:k,netOutstanding:Math.max(0,a),supplierBreakdown:m})}catch(j){console.error("Error fetching report data:",j)}finally{g(!1)}},b=()=>{const j=["Date","Supplier","Type","Description","Amount","Status","Due Date"],T=r.map(a=>{var p;return[new Date(a.created_at).toLocaleDateString("en-IN"),((p=a.supplier)==null?void 0:p.name)||"Unknown",h(a.type),a.description,parseFloat(a.amount.toString()),a.is_paid?"Paid":"Unpaid",a.due_date?new Date(a.due_date).toLocaleDateString("en-IN"):""]}),v=[j.join(","),...T.map(a=>a.map(p=>`"${p}"`).join(","))].join(`
`),B=new Blob([v],{type:"text/csv;charset=utf-8;"}),k=document.createElement("a"),m=URL.createObjectURL(B);k.setAttribute("href",m),k.setAttribute("download",`transactions-report-${S}-to-${w}.csv`),k.style.visibility="hidden",document.body.appendChild(k),k.click(),document.body.removeChild(k)},h=j=>{switch(j){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return j}},f=j=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(j);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Analyze your supplier transactions and dues"})]}),e.jsxs("button",{onClick:b,disabled:r.length===0,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:S,onChange:j=>O(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:w,onChange:j=>N(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),r.length," transactions found"]})]})}),u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f(s.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(ls,{className:"h-6 w-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f(s.totalPayments)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(is,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Net Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f(s.netOutstanding)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"h-6 w-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Supplier Breakdown"}),e.jsx(cs,{className:"h-5 w-5 text-gray-400"})]}),s.supplierBreakdown.length>0?e.jsx("div",{className:"space-y-4",children:s.supplierBreakdown.map((j,T)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:j.supplier}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["Outstanding: ",f(j.outstanding)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"font-medium text-red-600",children:f(j.purchases)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"font-medium text-green-600",children:f(j.payments)})]})]})]},T))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Oe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No data available for the selected period"})]})]})]})]})};class X{constructor(){this.isAuthenticated=!1,this.userEmail=""}static getInstance(){return X.instance||(X.instance=new X),X.instance}async initializeGoogleDrive(){console.log("Initializing Google Drive API...")}async authenticate(){try{return new Promise(s=>{setTimeout(()=>{this.isAuthenticated=!0,this.userEmail="user@gmail.com",s({success:!0,userEmail:this.userEmail})},2e3)})}catch(s){return console.error("Google Drive authentication failed:",s),{success:!1,userEmail:""}}}isConnected(){return this.isAuthenticated}getConnectedEmail(){return this.userEmail}async createBackup(s){try{return console.log("Creating backup on Google Drive...",s),new Promise(n=>{setTimeout(()=>{n({success:!0,fileId:`shopsynk-backup-${Date.now()}`})},3e3)})}catch(n){return console.error("Backup creation failed:",n),{success:!1}}}async scheduleAutoBackup(s){console.log("Auto backup scheduled for midnight daily");const n=new Date,r=new Date;r.setHours(24,0,0,0);const o=r.getTime()-n.getTime();setTimeout(()=>{s(),setInterval(s,24*60*60*1e3)},o)}disconnect(){this.isAuthenticated=!1,this.userEmail=""}}class Q{constructor(){this.googleDriveService=X.getInstance()}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}async exportUserData(s,n){try{const{data:r,error:o}=await y.from("suppliers").select("*").eq("user_id",s);if(o)throw o;const{data:u,error:g}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name, contact_person, phone, email)
        `).eq("user_id",s);if(g)throw g;return{suppliers:r||[],transactions:u||[],exportDate:new Date().toISOString(),userEmail:n}}catch(r){return console.error("Error exporting user data:",r),null}}async createBackup(s,n){try{if(!this.googleDriveService.isConnected())return{success:!1,message:"Google Drive not connected. Please connect first."};const r=await this.exportUserData(s,n);if(!r)return{success:!1,message:"Failed to export user data."};const o=await this.googleDriveService.createBackup(r);return o.success?(await this.recordBackup(s,o.fileId||"",r),{success:!0,message:"Backup created successfully on Google Drive!"}):{success:!1,message:"Failed to upload backup to Google Drive."}}catch(r){return console.error("Backup creation error:",r),{success:!1,message:"An error occurred during backup creation."}}}async recordBackup(s,n,r){try{await y.from("user_backups").insert([{user_id:s,backup_date:new Date().toISOString(),google_drive_file_id:n,suppliers_count:r.suppliers.length,transactions_count:r.transactions.length,backup_size:JSON.stringify(r).length,status:"completed"}])}catch(o){console.error("Error recording backup:",o)}}async setupAutoBackup(s,n){const r=async()=>{console.log("Running automatic backup...");const o=await this.createBackup(s,n);console.log("Auto backup result:",o.message),await this.sendBackupNotification(n,o.success)};await this.googleDriveService.scheduleAutoBackup(r)}async sendBackupNotification(s,n){console.log(`Backup notification sent to ${s}: ${n?"Success":"Failed"}`)}async getBackupHistory(s){try{const{data:n,error:r}=await y.from("user_backups").select("*").eq("user_id",s).order("backup_date",{ascending:!1}).limit(10);if(r)throw r;return n||[]}catch(n){return console.error("Error fetching backup history:",n),[]}}downloadBackupFile(s){const n=JSON.stringify(s,null,2),r=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(r),u=document.createElement("a");u.href=o,u.download=`shopsynk-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(o)}}const Is=()=>{const{user:t}=q(),[s,n]=i.useState(null),[r,o]=i.useState(!0),[u,g]=i.useState("pdf"),[S,O]=i.useState(!1),[w,N]=i.useState(!1),[d,b]=i.useState("");i.useEffect(()=>{h()},[t]);const h=async()=>{if(t)try{o(!0);const{count:a}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:p}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:P}=await y.from("business_owners").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:_}=await y.from("user_backups").select("created_at").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1).single(),C=.5,E=.3,U=.2,l=.1,I=(a||0)*C,F=(p||0)*E,A=(P||0)*U,M=I+F+A+l;n({totalTransactions:a||0,totalSuppliers:p||0,totalOwners:P||0,estimatedSizeKB:M,lastBackup:(_==null?void 0:_.created_at)||null,dataBreakdown:{transactions:{count:a||0,sizeKB:I},suppliers:{count:p||0,sizeKB:F},owners:{count:P||0,sizeKB:A},settings:{count:1,sizeKB:l}}})}catch(a){console.error("Error fetching storage stats:",a)}finally{o(!1)}},f=async a=>{if(t)try{O(!0);const[p,P,_]=await Promise.all([y.from("transactions").select("*, supplier:suppliers(name), owner:business_owners(owner_name)").eq("user_id",t.id).order("created_at",{ascending:!1}),y.from("suppliers").select("*").eq("user_id",t.id).order("name"),y.from("business_owners").select("*").eq("user_id",t.id).order("owner_name")]),C={exportDate:new Date().toISOString(),user:{id:t.id,email:t.email},summary:s,data:{transactions:p.data||[],suppliers:P.data||[],businessOwners:_.data||[]}};a==="json"?j(C):a==="csv"?T(C):a==="pdf"&&v(C)}catch(p){console.error("Error downloading data:",p),alert("Error downloading data. Please try again.")}finally{O(!1)}},j=a=>{const p=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),P=URL.createObjectURL(p),_=document.createElement("a");_.href=P,_.download=`shopsynk-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(P)},T=a=>{let p="Type,Supplier,Amount,Description,Date,Due Date,Status,Handled By\\n";a.data.transactions.forEach(E=>{var U,l;p+=`${E.type},"${((U=E.supplier)==null?void 0:U.name)||"Unknown"}",${E.amount},"${E.description}",${E.created_at},${E.due_date||""},${E.is_paid?"Paid":"Unpaid"},"${((l=E.owner)==null?void 0:l.owner_name)||"Unknown"}"\\n`});const P=new Blob([p],{type:"text/csv"}),_=URL.createObjectURL(P),C=document.createElement("a");C.href=_,C.download=`shopsynk-transactions-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(_)},v=a=>{const p=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Shopsynk Data Export</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1, h2 { color: #2563eb; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f8f9fa; }
          .summary { background-color: #f0f9ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <h1>Shopsynk Data Export</h1>
        <p><strong>Export Date:</strong> ${new Date().toLocaleDateString()}</p>
        <p><strong>User:</strong> ${(t==null?void 0:t.email)||"Unknown"}</p>
        
        <div class="summary">
          <h2>Summary</h2>
          <p><strong>Total Transactions:</strong> ${s==null?void 0:s.totalTransactions}</p>
          <p><strong>Total Suppliers:</strong> ${s==null?void 0:s.totalSuppliers}</p>
          <p><strong>Total Owners:</strong> ${s==null?void 0:s.totalOwners}</p>
          <p><strong>Estimated Size:</strong> ${((s==null?void 0:s.estimatedSizeKB)||0).toFixed(2)} KB</p>
        </div>

        <h2>Recent Transactions</h2>
        <table>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Supplier</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Handled By</th>
          </tr>
          ${a.data.transactions.slice(0,50).map(E=>{var U,l;return`
            <tr>
              <td>${new Date(E.created_at).toLocaleDateString()}</td>
              <td>${E.type}</td>
              <td>${((U=E.supplier)==null?void 0:U.name)||"Unknown"}</td>
              <td>${E.amount}</td>
              <td>${E.is_paid?"Paid":"Unpaid"}</td>
              <td>${((l=E.owner)==null?void 0:l.owner_name)||"Unknown"}</td>
            </tr>
          `}).join("")}
        </table>
      </body>
      </html>
    `,P=new Blob([p],{type:"text/html"}),_=URL.createObjectURL(P),C=document.createElement("a");C.href=_,C.download=`shopsynk-report-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(_)},B=async()=>{if(t)try{N(!0),b("Preparing backup...");const a=Q.getInstance();b("Creating backup..."),await a.createBackup(t.id,t.email||"unknown@email.com"),b("Backup completed successfully!"),setTimeout(()=>b(""),3e3),await h()}catch(a){console.error("Error creating manual backup:",a),b("Backup failed. Please try again."),setTimeout(()=>b(""),3e3)}finally{N(!1)}},k=a=>a<1?`${(a*1024).toFixed(0)} bytes`:a<1024?`${a.toFixed(2)} KB`:`${(a/1024).toFixed(2)} MB`,m=a=>a?new Date(a).toLocaleString():"Never";return r?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(V,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading storage information..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Data Storage & Export"}),e.jsxs("button",{onClick:h,className:"flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k((s==null?void 0:s.estimatedSizeKB)||0)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalTransactions})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalSuppliers})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Business Owners"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalOwners})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Storage Breakdown"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-5 w-5 text-green-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Transactions Data"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.transactions.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:k((s==null?void 0:s.dataBreakdown.transactions.sizeKB)||0)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{className:"h-5 w-5 text-purple-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Suppliers Data"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.suppliers.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:k((s==null?void 0:s.dataBreakdown.suppliers.sizeKB)||0)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 text-orange-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Business Owners"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.owners.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:k((s==null?void 0:s.dataBreakdown.owners.sizeKB)||0)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Data"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsxs("select",{value:u,onChange:a=>g(a.target.value),className:"w-full md:w-64 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"pdf",children:"PDF Report"}),e.jsx("option",{value:"csv",children:"CSV (Spreadsheet)"}),e.jsx("option",{value:"json",children:"JSON (Raw Data)"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{onClick:()=>f(u),disabled:S,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[S?e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(xe,{className:"h-4 w-4 mr-2"}),S?"Preparing...":`Download ${u.toUpperCase()}`]})}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:" PDF: Formatted report with summary and recent transactions"}),e.jsx("p",{children:" CSV: Spreadsheet format for analysis and import"}),e.jsx("p",{children:" JSON: Complete raw data for technical use"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Backup Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-6 w-6 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Last Backup"}),e.jsx("p",{className:"text-sm text-blue-700",children:m((s==null?void 0:s.lastBackup)||null)})]})]}),e.jsxs("button",{onClick:B,disabled:w,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[w?e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(os,{className:"h-4 w-4 mr-2"}),w?"Creating Backup...":"Create Backup Now"]})]}),d&&e.jsxs("div",{className:`flex items-center p-3 rounded-lg ${d.includes("failed")?"bg-red-50 border border-red-200 text-red-700":d.includes("success")?"bg-green-50 border border-green-200 text-green-700":"bg-yellow-50 border border-yellow-200 text-yellow-700"}`,children:[d.includes("failed")?e.jsx(oe,{className:"h-5 w-5 mr-2"}):d.includes("success")?e.jsx(de,{className:"h-5 w-5 mr-2"}):e.jsx(V,{className:"h-5 w-5 mr-2 animate-spin"}),d]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:" Automatic backups run daily when configured"}),e.jsx("p",{children:" Manual backups are stored in your connected Google Drive"}),e.jsx("p",{children:" Configure automatic backups in your Profile settings"})]})]})]})]})},Fs=()=>{const{user:t}=q(),[s,n]=i.useState({suppliersCount:0,transactionsCount:0,totalOutstanding:0,lastLogin:""}),[r,o]=i.useState(!0),[u,g]=i.useState({isConnected:!1,userEmail:"",lastBackup:"",autoBackupEnabled:!0}),[S,O]=i.useState([]),[w,N]=i.useState(!1),[d,b]=i.useState(!1),[h,f]=i.useState(""),j=Q.getInstance(),T=X.getInstance(),v=Y.getInstance(),[B,k]=i.useState([]),[m,a]=i.useState([]),[p,P]=i.useState(!1),[_,C]=i.useState(null),[E,U]=i.useState({owner_name:"",role:"Owner"}),[l,I]=i.useState("");i.useEffect(()=>{ie(),A(),M(),F()},[t]);const F=async()=>{var c;if(t)try{await v.ensurePrimaryOwner(t.id,t.email,(c=t.user_metadata)==null?void 0:c.full_name);const D=await v.getBusinessOwners(t.id);k(D);const z=await v.getOwnerStats(t.id);a(z)}catch(D){console.error("Error loading business owners:",D),I("Error loading business owners.")}},A=async()=>{if(t)try{const{data:c,error:D}=await y.from("user_settings").select("*").eq("user_id",t.id).single();if(D&&D.code!=="PGRST116")throw D;c&&g({isConnected:c.google_drive_connected||!1,userEmail:c.google_drive_email||"",lastBackup:c.last_backup_date||"",autoBackupEnabled:c.auto_backup_enabled||!0})}catch(c){console.error("Error loading Google Drive settings:",c)}},M=async()=>{if(t)try{const c=await j.getBackupHistory(t.id);O(c)}catch(c){console.error("Error loading backup history:",c)}},Z=async()=>{N(!0),f("");try{const c=await T.authenticate();c.success?(await y.from("user_settings").upsert({user_id:t==null?void 0:t.id,google_drive_connected:!0,google_drive_email:c.userEmail,updated_at:new Date().toISOString()}),g(D=>({...D,isConnected:!0,userEmail:c.userEmail})),f("Successfully connected to Google Drive!"),await j.setupAutoBackup(t.id,t.email)):f("Failed to connect to Google Drive. Please try again.")}catch(c){console.error("Google Drive connection error:",c),f("An error occurred while connecting to Google Drive.")}finally{N(!1)}},pe=async()=>{try{T.disconnect(),await y.from("user_settings").upsert({user_id:t==null?void 0:t.id,google_drive_connected:!1,google_drive_email:null,updated_at:new Date().toISOString()}),g(c=>({...c,isConnected:!1,userEmail:""})),f("Disconnected from Google Drive.")}catch(c){console.error("Error disconnecting Google Drive:",c),f("Error disconnecting from Google Drive.")}},ge=async()=>{if(t){b(!0),f("");try{const c=await j.createBackup(t.id,t.email);f(c.message),c.success&&(await M(),await A())}catch(c){console.error("Manual backup error:",c),f("An error occurred during backup.")}finally{b(!1)}}},J=async()=>{if(t)try{const c=await j.exportUserData(t.id,t.email);c?(j.downloadBackupFile(c),f("Backup file downloaded successfully!")):f("Failed to create backup file.")}catch(c){console.error("Download backup error:",c),f("Error creating backup file.")}},le=async()=>{if(t)try{const c=!u.autoBackupEnabled;await y.from("user_settings").upsert({user_id:t.id,auto_backup_enabled:c,updated_at:new Date().toISOString()}),g(D=>({...D,autoBackupEnabled:c})),f(`Auto backup ${c?"enabled":"disabled"}.`)}catch(c){console.error("Error toggling auto backup:",c),f("Error updating auto backup setting.")}},be=async c=>{if(c.preventDefault(),!!t)try{const D=await v.createBusinessOwner(t.id,E);D.success?(I("Owner added successfully!"),await F(),L()):I(`Error: ${D.error}`)}catch(D){console.error("Error adding owner:",D),I("An error occurred while adding the owner.")}},fe=c=>{C(c),U({owner_name:c.owner_name,role:c.role}),P(!0)},ye=async c=>{if(c.preventDefault(),!!_)try{const D=await v.updateBusinessOwner(_.id,E);D.success?(I("Owner updated successfully!"),await F(),L()):I(`Error: ${D.error}`)}catch(D){console.error("Error updating owner:",D),I("An error occurred while updating the owner.")}},x=async c=>{if(confirm("Are you sure you want to remove this owner? This action cannot be undone."))try{const D=await v.deactivateBusinessOwner(c);D.success?(I("Owner removed successfully."),await F()):I(`Error: ${D.error}`)}catch(D){console.error("Error removing owner:",D),I("An error occurred while removing the owner.")}},L=()=>{U({owner_name:"",role:"Owner"}),C(null),P(!1)},K=c=>m.find(D=>D.owner_id===c)||{total_transactions:0,total_purchases:0,total_payments:0,total_purchase_amount:0,total_payment_amount:0},ie=async()=>{if(t)try{const{count:c}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:D}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:z}=await y.from("transactions").select("type, amount, is_paid").eq("user_id",t.id);let W=0;z==null||z.forEach(R=>{R.type==="new_purchase"&&!R.is_paid?W+=parseFloat(R.amount.toString()):(R.type==="pay_due"||R.type==="settle_bill")&&(W-=parseFloat(R.amount.toString()))}),n({suppliersCount:c||0,transactionsCount:D||0,totalOutstanding:Math.max(0,W),lastLogin:t.last_sign_in_at||t.created_at||""})}catch(c){console.error("Error fetching user stats:",c)}finally{o(!1)}},je=c=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),ee=c=>new Date(c).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your account settings and view activity"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Account Information"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ne,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Address"}),e.jsx("p",{className:"font-medium text-gray-900",children:t==null?void 0:t.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ds,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Status"}),e.jsx("p",{className:"font-medium text-green-600",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Created"}),e.jsx("p",{className:"font-medium text-gray-900",children:t!=null&&t.created_at?ee(t.created_at):"N/A"})]})]}),s.lastLogin&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Sign In"}),e.jsx("p",{className:"font-medium text-gray-900",children:ee(s.lastLogin)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Summary"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"h-6 w-6 text-green-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:s.suppliersCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:s.transactionsCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Outstanding Amount"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:je(s.totalOutstanding)})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Business Owners"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage owners and track their activities"})]})]}),e.jsxs("button",{onClick:()=>P(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Add Owner"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.map(c=>{const D=K(c.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:c.is_primary?e.jsx(ms,{className:"h-5 w-5 text-yellow-500"}):e.jsx(ae,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:c.owner_name}),e.jsx("p",{className:"text-sm text-gray-600",children:c.role}),c.is_primary&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full",children:"Primary"})]})]}),!c.is_primary&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>fe(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Edit owner",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>x(c.id),className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Remove owner",children:e.jsx(qe,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-blue-600 font-medium",children:D.total_purchases}),e.jsx("p",{className:"text-gray-500",children:"Purchases"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-green-600 font-medium",children:D.total_payments}),e.jsx("p",{className:"text-gray-500",children:"Payments"})]}),e.jsxs("div",{className:"col-span-2 text-center",children:[e.jsx("p",{className:"text-purple-600 font-medium",children:je(D.total_purchase_amount-D.total_payment_amount)}),e.jsx("p",{className:"text-gray-500",children:"Net Activity"})]})]})})]},c.id)})}),B.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No business owners found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add owners to track who handles transactions"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Google Drive Backup"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Te,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[u.isConnected?e.jsx(de,{className:"h-5 w-5 text-green-500"}):e.jsx(ve,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Connection Status"}),e.jsx("p",{className:`font-medium ${u.isConnected?"text-green-600":"text-red-600"}`,children:u.isConnected?"Connected":"Not Connected"}),u.isConnected&&u.userEmail&&e.jsx("p",{className:"text-xs text-gray-500",children:u.userEmail})]})]}),u.isConnected&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(xs,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Auto Backup"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Daily at midnight"})]})]}),e.jsx("button",{onClick:le,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u.autoBackupEnabled?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u.autoBackupEnabled?"translate-x-6":"translate-x-1"}`})})]}),u.lastBackup&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Backup"}),e.jsx("p",{className:"font-medium text-gray-900",children:ee(u.lastBackup)})]})]}),e.jsx("div",{className:"flex space-x-3",children:u.isConnected?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ge,disabled:d,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:bg-green-400 flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Backup Now"]})}),e.jsx("button",{onClick:pe,className:"px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors",children:"Disconnect"})]}):e.jsx("button",{onClick:Z,disabled:w,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-400 flex items-center justify-center",children:w?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Connect Google Drive"]})})}),e.jsxs("button",{onClick:J,className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Download Local Backup"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Backup History"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(hs,{className:"h-6 w-6 text-green-600"})})]}),e.jsx("div",{className:"space-y-3",children:S.length>0?S.slice(0,5).map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${c.status==="completed"?"bg-green-500":c.status==="failed"?"bg-red-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ee(c.backup_date)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c.suppliers_count," suppliers, ",c.transactions_count," transactions"]})]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${c.status==="completed"?"bg-green-100 text-green-700":c.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:c.status})]},c.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No backups yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Connect Google Drive to start automatic backups"})]})})]})]}),h&&e.jsx("div",{className:`border rounded-lg p-4 ${h.includes("Success")||h.includes("successfully")?"bg-green-50 border-green-200":h.includes("Error")||h.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[h.includes("Success")||h.includes("successfully")?e.jsx(de,{className:"h-5 w-5 text-green-600 mt-0.5"}):h.includes("Error")||h.includes("Failed")?e.jsx(ve,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(oe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${h.includes("Success")||h.includes("successfully")?"text-green-800":h.includes("Error")||h.includes("Failed")?"text-red-800":"text-blue-800"}`,children:h})})]})}),l&&e.jsx("div",{className:`border rounded-lg p-4 ${l.includes("Success")||l.includes("successfully")?"bg-green-50 border-green-200":l.includes("Error")||l.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[l.includes("Success")||l.includes("successfully")?e.jsx(de,{className:"h-5 w-5 text-green-600 mt-0.5"}):l.includes("Error")||l.includes("Failed")?e.jsx(ve,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(oe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${l.includes("Success")||l.includes("successfully")?"text-green-800":l.includes("Error")||l.includes("Failed")?"text-red-800":"text-blue-800"}`,children:l})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:_?"Edit Owner":"Add New Owner"}),e.jsxs("form",{onSubmit:_?ye:be,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Owner Name *"}),e.jsx("input",{type:"text",required:!0,value:E.owner_name,onChange:c=>U({...E,owner_name:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter owner's full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role/Title"}),e.jsx("input",{type:"text",value:E.role,onChange:c=>U({...E,role:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"e.g., Owner, Partner, Manager"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:L,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:_?"Update Owner":"Add Owner"})]})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(oe,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Your data is securely stored and encrypted. Always sign out when using shared devices. If you notice any unusual activity, please contact support immediately."})]})]})})]})};function Ls(){return e.jsx(vs,{children:e.jsx(Xe,{children:e.jsx("div",{className:"App",children:e.jsxs(Pe,{children:[e.jsx($,{path:"/login",element:e.jsx(Cs,{})}),e.jsx($,{path:"/register",element:e.jsx(Ps,{})}),e.jsx($,{path:"/*",element:e.jsx(_s,{children:e.jsx(Ds,{children:e.jsxs(Pe,{children:[e.jsx($,{path:"/",element:e.jsx(Es,{})}),e.jsx($,{path:"/suppliers",element:e.jsx(Os,{})}),e.jsx($,{path:"/suppliers/:id",element:e.jsx(Bs,{})}),e.jsx($,{path:"/transactions",element:e.jsx(Ts,{})}),e.jsx($,{path:"/reports",element:e.jsx(As,{})}),e.jsx($,{path:"/data-storage",element:e.jsx(Is,{})}),e.jsx($,{path:"/profile",element:e.jsx(Fs,{})}),e.jsx($,{path:"*",element:e.jsx(Ie,{to:"/",replace:!0})})]})})})})]})})})})}We(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Ls,{})}));
