import{r as o,a as es,N as qe,u as ae,b as ss,R as ts,L as ze,d as rs,B as as,e as Le,f as U}from"./vendor-DsmcgGc9.js";import{c as ns}from"./supabase-6T48ApRq.js";import{X as ie,D as be,R as H,M as ls,U as pe,L as is,H as os,a as Y,b as M,F as cs,c as Ge,d as re,e as De,E as Pe,f as Ee,A as Ke,g as se,T as _e,h as Be,i as Te,P as ge,S as We,j as Oe,k as Ae,l as ds,m as He,n as Je,C as Se,o as ke,p as te,q as us,r as ms,s as xs,t as $e,u as hs,v as Ue,w as me,x as ps,y as xe,z as he,B as gs,G as bs,I as fs,J as Re,K as Ce,N as ys,O as js}from"./ui-DzHBtPrY.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function n(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(d){if(d.ep)return;d.ep=!0;const u=n(d);fetch(d.href,u)}})();var Ye={exports:{}},fe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ws=o,Ns=Symbol.for("react.element"),vs=Symbol.for("react.fragment"),_s=Object.prototype.hasOwnProperty,Ss=ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ks={key:!0,ref:!0,__self:!0,__source:!0};function Ve(t,s,n){var r,d={},u=null,h=null;n!==void 0&&(u=""+n),s.key!==void 0&&(u=""+s.key),s.ref!==void 0&&(h=s.ref);for(r in s)_s.call(s,r)&&!ks.hasOwnProperty(r)&&(d[r]=s[r]);if(t&&t.defaultProps)for(r in s=t.defaultProps,s)d[r]===void 0&&(d[r]=s[r]);return{$$typeof:Ns,type:t,key:u,ref:h,props:d,_owner:Ss.current}}fe.Fragment=vs;fe.jsx=Ve;fe.jsxs=Ve;Ye.exports=fe;var e=Ye.exports,Ze,Me=es;Ze=Me.createRoot,Me.hydrateRoot;const Cs="https://gxgiqmmlvdgrzvbgmgfp.supabase.co",Ds="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4Z2lxbW1sdmRncnp2YmdtZ2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTA4OTEsImV4cCI6MjA3MTY2Njg5MX0.VzO5yGWCFpN6ZU7d76tK9ADFPNwukuQ96RD3iILpAg0",y=ns(Cs,Ds),Xe=o.createContext(void 0),R=()=>{const t=o.useContext(Xe);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},Ps=({children:t})=>{const[s,n]=o.useState(null),[r,d]=o.useState(!0);o.useEffect(()=>{y.auth.getUser().then(({data:{user:g}})=>{n(g),d(!1)});const{data:{subscription:x}}=y.auth.onAuthStateChange((g,S)=>{n((S==null?void 0:S.user)??null),d(!1)});return()=>x.unsubscribe()},[]);const w={user:s,loading:r,signUp:async(x,g)=>{const{data:S,error:k}=await y.auth.signUp({email:x,password:g});return{data:S,error:k}},signIn:async(x,g)=>{const{data:S,error:k}=await y.auth.signInWithPassword({email:x,password:g});return{data:S,error:k}},signOut:async()=>{const{error:x}=await y.auth.signOut();if(x)throw x}};return e.jsx(Xe.Provider,{value:w,children:t})},Es=({children:t})=>{const{user:s,loading:n}=R();return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(qe,{to:"/login",replace:!0})},Os=()=>{const[t,s]=o.useState(null),[n,r]=o.useState(!1),[d,u]=o.useState(!1),[h,C]=o.useState(!1);o.useEffect(()=>{const g=/iPad|iPhone|iPod/.test(navigator.userAgent);u(g);const S=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");C(S);const k=N=>{N.preventDefault(),s(N),r(!0)};return window.addEventListener("beforeinstallprompt",k),()=>{window.removeEventListener("beforeinstallprompt",k)}},[]);const w=async()=>{if(!t)return;t.prompt();const{outcome:g}=await t.userChoice;console.log(g==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),s(null),r(!1)},x=()=>{r(!1),sessionStorage.setItem("installPromptDismissed","true")};return h||sessionStorage.getItem("installPromptDismissed")==="true"?null:d&&!h?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 bg-blue-600 text-white p-4 rounded-lg shadow-lg border border-blue-500",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Install Shopsynk"}),e.jsxs("p",{className:"text-xs mt-1 opacity-90",children:["Install this app on your iPhone: tap ",e.jsx("span",{className:"font-bold",children:"Share"})," and then ",e.jsx("span",{className:"font-bold",children:"Add to Home Screen"})]})]}),e.jsx("button",{onClick:x,className:"ml-2 p-1 hover:bg-blue-700 rounded",children:e.jsx(ie,{className:"h-4 w-4"})})]})}):n&&t?e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg shadow-lg border border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(be,{className:"h-5 w-5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Install Shopsynk App"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Get the full app experience with offline access and notifications"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:w,className:"bg-white text-blue-600 px-3 py-1 rounded text-xs font-medium hover:bg-gray-100 transition-colors",children:"Install"}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-blue-700 rounded",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})}):null},As=()=>{const[t,s]=o.useState(!1),[n,r]=o.useState(null);o.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(h=>{h.waiting&&(r(h.waiting),s(!0)),h.addEventListener("updatefound",()=>{const C=h.installing;C&&C.addEventListener("statechange",()=>{C.state==="installed"&&navigator.serviceWorker.controller&&(r(C),s(!0))})})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))},[]);const d=()=>{n&&(n.postMessage({type:"SKIP_WAITING"}),s(!1))},u=()=>{s(!1)};return t?e.jsx("div",{className:"fixed top-4 left-4 right-4 z-50 bg-green-600 text-white p-4 rounded-lg shadow-lg border border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(H,{className:"h-5 w-5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"App Update Available"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"A new version of Shopsynk is ready to install"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:d,className:"bg-white text-green-600 px-3 py-1 rounded text-xs font-medium hover:bg-gray-100 transition-colors",children:"Update"}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-green-700 rounded",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})}):null},Bs=({children:t})=>{const{user:s,signOut:n}=R(),r=ae(),d=ss(),[u,h]=ts.useState(!1),C=async()=>{try{await n(),r("/login")}catch(g){console.error("Error signing out:",g)}},w=[{name:"Dashboard",path:"/",icon:os},{name:"Suppliers",path:"/suppliers",icon:Y},{name:"Transactions",path:"/transactions",icon:M},{name:"Reports",path:"/reports",icon:cs},{name:"Data Storage",path:"/data-storage",icon:Ge}],x=g=>g==="/"?d.pathname==="/":d.pathname.startsWith(g);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:e.jsx("button",{onClick:()=>h(!u),className:"bg-white p-2 rounded-lg shadow-md border border-gray-200 hover:bg-gray-50 transition-colors",children:u?e.jsx(ie,{className:"h-6 w-6"}):e.jsx(ls,{className:"h-6 w-6"})})}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg border-r border-gray-200 transform transition-transform duration-200 ease-in-out lg:translate-x-0 ${u?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-center h-16 bg-blue-600 text-white",children:e.jsx("h1",{className:"text-xl font-bold",children:"Shopsynk"})}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:w.map(g=>{const S=g.icon;return e.jsxs("button",{onClick:()=>{r(g.path),h(!1)},className:`w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ${x(g.path)?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(S,{className:"h-5 w-5 mr-3"}),g.name]},g.name)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>r("/profile"),className:"w-full flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:"Profile Settings"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s==null?void 0:s.email})]})]})}),e.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center p-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})}),e.jsx("div",{className:"lg:pl-64",children:e.jsx("main",{className:"p-6 lg:p-8",children:t})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>h(!1)}),e.jsx(Os,{}),e.jsx(As,{})]})},Ts=()=>{const[t,s]=o.useState(""),[n,r]=o.useState(""),[d,u]=o.useState(!1),[h,C]=o.useState(!1),[w,x]=o.useState(""),{signIn:g}=R(),S=ae(),k=async N=>{N.preventDefault(),C(!0),x("");try{const{error:b}=await g(t,n);if(b)throw b;S("/")}catch(b){x(b.message)}finally{C(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sign in to manage your supplier dues"})]}),w&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:w}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:N=>s(N.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:d?"text":"password",value:n,onChange:N=>r(N.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your password",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:d?e.jsx(Pe,{className:"h-5 w-5"}):e.jsx(Ee,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:h?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Sign In",e.jsx(Ke,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(ze,{to:"/register",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Create one"})]})})]})})})},Is=()=>{const[t,s]=o.useState(""),[n,r]=o.useState(""),[d,u]=o.useState(""),[h,C]=o.useState(!1),[w,x]=o.useState(!1),[g,S]=o.useState(!1),[k,N]=o.useState(""),[b,f]=o.useState(""),{signUp:A}=R(),P=ae(),T=async m=>{if(m.preventDefault(),S(!0),N(""),f(""),n!==d){N("Passwords do not match"),S(!1);return}try{const{error:i}=await A(t,n);if(i)throw i;f("Account created successfully! You can now sign in."),setTimeout(()=>P("/login"),2e3)}catch(i){N(i.message)}finally{S(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"DT"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Start managing your supplier dues today"})]}),k&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-50 border border-red-200 text-red-600 text-sm",children:k}),b&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-600 text-sm",children:b}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:m=>s(m.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter your email",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:h?"text":"password",value:n,onChange:m=>r(m.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Create a password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>C(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:h?e.jsx(Pe,{className:"h-5 w-5"}):e.jsx(Ee,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:w?"text":"password",value:d,onChange:m=>u(m.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Confirm your password",required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>x(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:w?e.jsx(Pe,{className:"h-5 w-5"}):e.jsx(Ee,{className:"h-5 w-5"})})]})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:g?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Create Account",e.jsx(Ke,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(ze,{to:"/login",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})})]})})})},Fs=()=>{const{user:t}=R(),s=ae(),[n,r]=o.useState({totalDues:0,totalSuppliers:0,totalTransactions:0,pendingPayments:0,recentTransactions:[],upcomingDues:[]}),[d,u]=o.useState(!0);o.useEffect(()=>{h()},[t]);const h=async()=>{if(t)try{const{count:x}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:g}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:S}=await y.from("transactions").select("*").eq("user_id",t.id),k=new Map;S==null||S.forEach(m=>{const i=m.supplier_id;k.has(i)||k.set(i,0),m.type==="new_purchase"?k.set(i,k.get(i)+parseFloat(m.amount)):(m.type==="pay_due"||m.type==="settle_bill")&&k.set(i,k.get(i)-parseFloat(m.amount))});let N=0,b=0;k.forEach(m=>{m>.01&&(N+=m,b++)});const{data:f}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1}).limit(5),{data:A}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1}),P=new Map;A==null||A.forEach(m=>{var v;const i=m.supplier_id,l=(v=m.supplier)==null?void 0:v.name;P.has(i)||P.set(i,{supplier_id:i,supplier_name:l,balance:0,lastTransaction:m,dueDate:null});const p=P.get(i);m.type==="new_purchase"?(p.balance+=parseFloat(m.amount),m.due_date&&(!p.dueDate||m.due_date<p.dueDate)&&(p.dueDate=m.due_date)):(m.type==="pay_due"||m.type==="settle_bill")&&(p.balance-=parseFloat(m.amount))});const T=Array.from(P.values()).filter(m=>m.balance>.01).map(m=>({id:`outstanding-${m.supplier_id}`,supplier_id:m.supplier_id,supplier:{name:m.supplier_name},amount:m.balance.toFixed(2),description:"Outstanding balance",due_date:m.dueDate,type:"outstanding"})).sort((m,i)=>m.due_date&&!i.due_date?-1:!m.due_date&&i.due_date?1:m.due_date&&i.due_date&&m.due_date!==i.due_date?m.due_date.localeCompare(i.due_date):parseFloat(i.amount)-parseFloat(m.amount)).slice(0,10);r({totalDues:Math.max(0,N),totalSuppliers:x||0,totalTransactions:g||0,pendingPayments:b,recentTransactions:f||[],upcomingDues:T||[]})}catch(x){console.error("Error fetching dashboard data:",x)}finally{u(!1)}},C=x=>{switch(x){case"new_purchase":return e.jsx(Te,{className:"h-4 w-4 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(Be,{className:"h-4 w-4 text-green-500"});default:return e.jsx(M,{className:"h-4 w-4 text-gray-500"})}},w=x=>{switch(x){case"new_purchase":return"Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return x}};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Your business overview"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"h-6 w-6 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Outstanding"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["₹",Math.round(n.totalDues).toLocaleString()]})]})}),e.jsx("button",{onClick:()=>s("/suppliers"),className:"bg-white rounded-lg p-4 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-6 w-6 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Suppliers"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:n.totalSuppliers})]})}),e.jsx("button",{onClick:()=>s("/transactions"),className:"bg-white rounded-lg p-4 border border-gray-200 hover:border-green-300 hover:bg-green-50 transition-colors w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"h-6 w-6 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Transactions"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:n.totalTransactions})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{className:"h-6 w-6 text-orange-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pending"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:n.pendingPayments})]})})]}),e.jsxs("div",{className:"space-y-4 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("button",{onClick:()=>s("/transactions"),className:"text-blue-600 text-sm font-medium",children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:n.recentTransactions.length>0?n.recentTransactions.slice(0,4).map(x=>{var g;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[C(x.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:(g=x.supplier)==null?void 0:g.name}),e.jsx("p",{className:"text-sm text-gray-500",children:w(x.type)})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-medium ${x.type==="new_purchase"?"text-red-600":"text-green-600"}`,children:[x.type==="new_purchase"?"+":"-","₹",Math.round(parseFloat(x.amount)).toLocaleString()]})})]},x.id)}):e.jsx("p",{className:"text-gray-500 text-center py-6 text-sm",children:"No transactions yet"})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Payments Due"}),e.jsx(_e,{className:"h-5 w-5 text-orange-400"})]}),e.jsx("div",{className:"space-y-3",children:n.upcomingDues.length>0?n.upcomingDues.slice(0,4).map(x=>{var g;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-100",onClick:()=>s(`/suppliers/${x.supplier_id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:(g=x.supplier)==null?void 0:g.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Outstanding balance"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium text-red-600",children:["₹",Math.round(parseFloat(x.amount)).toLocaleString()]})})]},x.id)}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(_e,{className:"h-8 w-8 text-green-500 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"All payments up to date!"})]})})]})]})]})},Ls=()=>{const{user:t}=R(),s=ae(),[n,r]=o.useState([]),[d,u]=o.useState(!0),[h,C]=o.useState(""),[w,x]=o.useState("dues_desc"),[g,S]=o.useState("all"),[k,N]=o.useState(!1),[b,f]=o.useState({name:"",contact_person:"",phone:"",email:"",address:""});o.useEffect(()=>{A()},[t]);const A=async()=>{if(t)try{const{data:i,error:l}=await y.from("suppliers").select("*").eq("user_id",t.id);if(l)throw l;const{data:p,error:v}=await y.from("transactions").select("*").eq("user_id",t.id);if(v)throw v;const j=new Map;p==null||p.forEach(_=>{const B=_.supplier_id;j.has(B)||j.set(B,0),_.type==="new_purchase"?j.set(B,j.get(B)+parseFloat(_.amount)):(_.type==="pay_due"||_.type==="settle_bill")&&j.set(B,j.get(B)-parseFloat(_.amount))});const D=(i||[]).map(_=>({..._,dueAmount:Math.max(0,j.get(_.id)||0)}));r(D)}catch(i){console.error("Error fetching suppliers:",i)}finally{u(!1)}},P=async i=>{if(i.preventDefault(),!!t)try{const{error:l}=await y.from("suppliers").insert([{...b,user_id:t.id}]);if(l)throw l;await A(),T()}catch(l){console.error("Error adding supplier:",l)}},T=()=>{f({name:"",contact_person:"",phone:"",email:"",address:""}),N(!1)},m=n.filter(i=>{var v,j,D;const l=i.name.toLowerCase().includes(h.toLowerCase())||((v=i.contact_person)==null?void 0:v.toLowerCase().includes(h.toLowerCase()))||((j=i.phone)==null?void 0:j.includes(h))||((D=i.email)==null?void 0:D.toLowerCase().includes(h.toLowerCase())),p=g==="all"||g==="with_dues"&&i.dueAmount>0||g==="no_dues"&&i.dueAmount===0||g==="high_dues"&&i.dueAmount>1e4||g==="medium_dues"&&i.dueAmount>1e3&&i.dueAmount<=1e4||g==="low_dues"&&i.dueAmount>0&&i.dueAmount<=1e3;return l&&p}).sort((i,l)=>{switch(w){case"dues_desc":return l.dueAmount-i.dueAmount;case"dues_asc":return i.dueAmount-l.dueAmount;case"name_asc":return i.name.localeCompare(l.name);case"name_desc":return l.name.localeCompare(i.name);default:return l.dueAmount-i.dueAmount}});return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-1",children:"Suppliers"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Manage your business relationships"})]}),e.jsxs("button",{onClick:()=>N(!0),className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-medium flex items-center justify-center hover:from-blue-600 hover:to-blue-700 shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:[e.jsx(ge,{className:"h-5 w-5 mr-2"}),"Add Supplier"]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, contact, phone, or email...",value:h,onChange:i=>C(i.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base"})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:g,onChange:i=>S(i.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-base",children:[e.jsx("option",{value:"all",children:"🏢 All Suppliers"}),e.jsx("option",{value:"with_dues",children:"💰 With Dues"}),e.jsx("option",{value:"no_dues",children:"✅ No Dues"}),e.jsxs("option",{value:"high_dues",children:["🔥 High Dues (",">","₹10K)"]}),e.jsx("option",{value:"medium_dues",children:"⚠️ Medium Dues (₹1K-₹10K)"}),e.jsxs("option",{value:"low_dues",children:["📊 Low Dues (","<","₹1K)"]})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:w,onChange:i=>x(i.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-base",children:[e.jsx("option",{value:"dues_desc",children:"📈 Highest Dues First"}),e.jsx("option",{value:"dues_asc",children:"📉 Lowest Dues First"}),e.jsx("option",{value:"name_asc",children:"🔤 Name A to Z"}),e.jsx("option",{value:"name_desc",children:"🔤 Name Z to A"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Total Suppliers"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.filter(i=>i.dueAmount>0).length}),e.jsx("p",{className:"text-xs font-medium text-red-700",children:"With Dues"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(i=>i.dueAmount===0).length}),e.jsx("p",{className:"text-xs font-medium text-green-700",children:"All Clear"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["₹",Math.round(n.reduce((i,l)=>i+l.dueAmount,0)).toLocaleString()]}),e.jsx("p",{className:"text-xs font-medium text-purple-700",children:"Total Dues"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:m.length===0?e.jsxs("div",{className:"col-span-full text-center py-16 bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No suppliers found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:h?"Try adjusting your search or filters":"Add your first supplier to get started"}),!h&&e.jsx("button",{onClick:()=>N(!0),className:"bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-colors",children:"Add Your First Supplier"})]}):m.map(i=>e.jsxs("div",{onClick:()=>s(`/suppliers/${i.id}`),className:"bg-white rounded-xl border border-gray-200 p-5 hover:border-blue-300 hover:shadow-lg transition-all duration-200 cursor-pointer group transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg truncate group-hover:text-blue-600 transition-colors",children:i.name}),i.contact_person&&e.jsx("p",{className:"text-sm text-gray-600 truncate mt-1",children:i.contact_person})]}),e.jsxs("div",{className:"ml-4 text-right",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-bold ${i.dueAmount>0?i.dueAmount>1e4?"bg-red-100 text-red-700":i.dueAmount>1e3?"bg-yellow-100 text-yellow-700":"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:["₹",Math.round(i.dueAmount).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.dueAmount>0?"Due Amount":"All Clear"})]})]}),e.jsxs("div",{className:"space-y-2",children:[i.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center mr-3",children:e.jsx(Oe,{className:"h-4 w-4 text-blue-500"})}),e.jsx("span",{className:"font-medium",children:i.phone})]}),i.email&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center mr-3",children:e.jsx(re,{className:"h-4 w-4 text-green-500"})}),e.jsx("span",{className:"truncate font-medium",children:i.email})]}),i.address&&e.jsxs("div",{className:"flex items-start text-sm text-gray-600",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center mr-3 mt-0.5",children:e.jsx(Ae,{className:"h-4 w-4 text-purple-500"})}),e.jsx("span",{className:"line-clamp-2 font-medium",children:i.address})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-100",children:e.jsx("p",{className:"text-xs text-gray-400 text-center group-hover:text-blue-400 transition-colors",children:"Tap to view details & manage"})})]},i.id))}),e.jsx("button",{onClick:()=>N(!0),className:"fixed bottom-6 right-6 sm:hidden w-14 h-14 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full shadow-2xl hover:from-blue-600 hover:to-blue-700 flex items-center justify-center z-40 transform hover:scale-110 transition-all duration-200",style:{boxShadow:"0 10px 25px rgba(59, 130, 246, 0.5)"},children:e.jsx(ge,{className:"h-6 w-6"})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-end sm:items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-lg max-h-[95vh] sm:max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsx("div",{className:"sticky top-0 bg-white rounded-t-2xl sm:rounded-t-2xl z-10",children:e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add New Supplier"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Fill in the supplier details"})]}),e.jsx("button",{onClick:T,className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-xl text-gray-500",children:"×"})})]})}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Supplier Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:i=>f({...b,name:i.target.value}),required:!0,className:"w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base transition-colors",placeholder:"Enter supplier or company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Contact Person"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:b.contact_person,onChange:i=>f({...b,contact_person:i.target.value}),className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base",placeholder:"Primary contact person"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"tel",value:b.phone,onChange:i=>f({...b,phone:i.target.value}),className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base",placeholder:"Mobile or landline number"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",value:b.email,onChange:i=>f({...b,email:i.target.value}),className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base",placeholder:"contact@supplier.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Business Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-4 top-4 h-5 w-5 text-gray-400"}),e.jsx("textarea",{value:b.address,onChange:i=>f({...b,address:i.target.value}),rows:4,className:"w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-base resize-none",placeholder:"Complete business address including city and state"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:T,className:"order-2 sm:order-1 flex-1 px-6 py-4 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"order-1 sm:order-2 flex-1 px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 font-medium shadow-lg transition-all duration-200",children:"Add Supplier"})]})]})]})})]})};class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}async getBusinessOwners(s){try{const{data:n,error:r}=await y.from("business_owners").select("*").eq("user_id",s).eq("is_active",!0).order("is_primary",{ascending:!1}).order("created_at",{ascending:!0});if(r)throw r;return n||[]}catch(n){return console.error("Error fetching business owners:",n),[]}}async getPrimaryOwner(s){try{const{data:n,error:r}=await y.from("business_owners").select("*").eq("user_id",s).eq("is_primary",!0).eq("is_active",!0).single();if(r&&r.code!=="PGRST116")throw r;return n||null}catch(n){return console.error("Error fetching primary owner:",n),null}}async createBusinessOwner(s,n){try{const{data:r,error:d}=await y.from("business_owners").insert([{user_id:s,owner_name:n.owner_name,role:n.role||"Owner",is_primary:!1,is_active:!0}]).select().single();if(d)throw d;return{success:!0,data:r}}catch(r){return console.error("Error creating business owner:",r),{success:!1,error:r.message||"Failed to create business owner"}}}async updateBusinessOwner(s,n){try{const{data:r,error:d}=await y.from("business_owners").update({owner_name:n.owner_name,role:n.role,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(d)throw d;return{success:!0,data:r}}catch(r){return console.error("Error updating business owner:",r),{success:!1,error:r.message||"Failed to update business owner"}}}async deactivateBusinessOwner(s){try{const{data:n,error:r}=await y.from("business_owners").select("is_primary").eq("id",s).single();if(r)throw r;if(n.is_primary)return{success:!1,error:"Cannot deactivate the primary owner"};const{error:d}=await y.from("business_owners").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",s);if(d)throw d;return{success:!0}}catch(n){return console.error("Error deactivating business owner:",n),{success:!1,error:n.message||"Failed to deactivate business owner"}}}async getOwnerStats(s){try{const{data:n,error:r}=await y.from("owner_transaction_stats").select("*").eq("user_id",s);if(r)throw r;return n||[]}catch(n){return console.error("Error fetching owner stats:",n),[]}}async ensurePrimaryOwner(s,n,r){try{const d=await this.getPrimaryOwner(s);if(d)return d;const u=await this.createBusinessOwner(s,{owner_name:r||n.split("@")[0],role:"Primary Owner",is_primary:!0});return u.success?u.data:null}catch(d){return console.error("Error ensuring primary owner:",d),null}}async updateTransactionOwner(s,n){try{const{error:r}=await y.from("transactions").update({owner_id:n}).eq("id",s);if(r)throw r;return{success:!0}}catch(r){return console.error("Error updating transaction owner:",r),{success:!1,error:r.message||"Failed to update transaction owner"}}}async updateSupplierOwner(s,n){try{const{error:r}=await y.from("suppliers").update({added_by_owner_id:n}).eq("id",s);if(r)throw r;return{success:!0}}catch(r){return console.error("Error updating supplier owner:",r),{success:!1,error:r.message||"Failed to update supplier owner"}}}}const $s=()=>{const{id:t}=rs(),{user:s}=R(),n=ae(),[r,d]=o.useState(null),[u,h]=o.useState([]),[C,w]=o.useState([]),[x,g]=o.useState(!0),[S,k]=o.useState(!1),[N,b]=o.useState(!1),[f,A]=o.useState(""),[P,T]=o.useState(""),[m,i]=o.useState(""),[l,p]=o.useState(""),[v,j]=o.useState(""),[D,_]=o.useState(""),[B,O]=o.useState(""),[F,q]=o.useState(0),[V,z]=o.useState(!1),[L,K]=o.useState({name:"",contact_person:"",phone:"",email:"",address:""}),[I,ye]=o.useState({totalPurchases:0,totalPaid:0,totalDue:0,transactionCount:0});o.useEffect(()=>{t&&Q()},[t,s]);const Q=async()=>{if(!(!s||!t))try{const{data:a,error:E}=await y.from("suppliers").select("*").eq("id",t).eq("user_id",s.id).single();if(E)throw E;const{data:$,error:G}=await y.from("transactions").select(`
          *,
          owner:business_owners(owner_name)
        `).eq("supplier_id",t).eq("user_id",s.id).order("created_at",{ascending:!1});if(G)throw G;const Qe=await J.getInstance().getBusinessOwners(s.id);d(a),h($||[]),w(Qe||[]);let Ie=0,Fe=0,de=0;$==null||$.forEach(le=>{const ue=parseFloat(le.amount.toString());le.type==="new_purchase"?(Ie+=ue,le.is_paid||(de+=ue)):(le.type==="pay_due"||le.type==="settle_bill")&&(Fe+=ue,de-=ue)}),q(Math.max(0,de)),ye({totalPurchases:Ie,totalPaid:Fe,totalDue:Math.max(0,de),transactionCount:($==null?void 0:$.length)||0})}catch(a){console.error("Error fetching supplier data:",a)}finally{g(!1)}},je=async a=>{if(a.preventDefault(),!(!s||!t||!f))try{const{error:E}=await y.from("transactions").insert([{user_id:s.id,supplier_id:t,type:"pay_due",amount:parseFloat(f),description:B||"Payment made",is_paid:!0,owner_id:P||null}]);if(E)throw E;await Q(),k(!1),A(""),T(""),O("")}catch(E){console.error("Error processing payment:",E)}},we=async a=>{if(a.preventDefault(),!(!s||!t||!m))try{const{error:E}=await y.from("transactions").insert([{user_id:s.id,supplier_id:t,type:"new_purchase",amount:parseFloat(m),description:v||"New purchase",due_date:D||null,is_paid:!1,owner_id:l||null}]);if(E)throw E;await Q(),b(!1),i(""),p(""),j(""),_("")}catch(E){console.error("Error adding purchase:",E)}},Ne=async a=>{if(a.preventDefault(),!(!s||!t))try{const{error:E}=await y.from("suppliers").update(L).eq("id",t).eq("user_id",s.id);if(E)throw E;await Q(),z(!1)}catch(E){console.error("Error updating supplier:",E)}},ve=async()=>{if(!(!s||!t||!window.confirm(`Are you sure you want to delete ${r==null?void 0:r.name}? This will also delete all associated transactions. This action cannot be undone.`)))try{await y.from("transactions").delete().eq("supplier_id",t).eq("user_id",s.id);const{error:E}=await y.from("suppliers").delete().eq("id",t).eq("user_id",s.id);if(E)throw E;n("/suppliers")}catch(E){console.error("Error deleting supplier:",E)}},ne=()=>{r&&(K({name:r.name,contact_person:r.contact_person||"",phone:r.phone||"",email:r.email||"",address:r.address||""}),z(!0))},W=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),oe=a=>new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),ce=a=>{switch(a){case"new_purchase":return e.jsx(Te,{className:"h-5 w-5 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(Be,{className:"h-5 w-5 text-green-500"});default:return e.jsx(M,{className:"h-5 w-5 text-gray-500"})}},ee=a=>{switch(a){case"new_purchase":return"Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return a}},c=a=>{switch(a){case"new_purchase":return"text-red-600";case"pay_due":case"settle_bill":return"text-green-600";default:return"text-gray-600"}};return x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>n("/suppliers"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ds,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:r.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Supplier Details & Transaction History"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:ne,className:"bg-gray-600 text-white px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center",title:"Edit Supplier",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:ve,className:"bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center",title:"Delete Supplier",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Delete"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:W(I.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(ke,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Paid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:W(I.totalPaid)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Se,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Outstanding Due"}),e.jsx("p",{className:`text-2xl font-bold ${I.totalDue>0?"text-red-600":"text-gray-400"}`,children:W(I.totalDue)})]}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${I.totalDue>0?"bg-red-100":"bg-gray-100"}`,children:e.jsx(se,{className:`h-6 w-6 ${I.totalDue>0?"text-red-600":"text-gray-400"}`})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:I.transactionCount})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-gray-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r.name}),r.contact_person&&e.jsx("p",{className:"text-gray-600",children:r.contact_person})]})]}),e.jsxs("div",{className:"space-y-4",children:[r.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:r.phone})]}),r.email&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:r.email})]}),r.address&&e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ae,{className:"h-5 w-5 text-gray-400 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:r.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Status"}),e.jsx(se,{className:"h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Rate"}),e.jsx("span",{className:"text-sm font-medium",children:I.totalPurchases>0?`${Math.round(I.totalPaid/I.totalPurchases*100)}%`:"0%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:I.totalPurchases>0?`${Math.min(I.totalPaid/I.totalPurchases*100,100)}%`:"0%"}})}),e.jsxs("div",{className:"text-center pt-2",children:[e.jsx("p",{className:`text-2xl font-bold ${I.totalDue>0?"text-red-600":"text-green-600"}`,children:I.totalDue>0?W(I.totalDue):"All Clear!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:I.totalDue>0?"Outstanding Balance":"No pending dues"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transaction History"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),"Pay Due"]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"New Purchase"]})]})]})}),e.jsx("div",{className:"p-6",children:u.length>0?e.jsx("div",{className:"space-y-4",children:u.map(a=>{var E;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ce(a.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:ee(a.type)}),!a.is_paid&&a.type==="new_purchase"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"Unpaid"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:a.description}),((E=a.owner)==null?void 0:E.owner_name)&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[a.type==="new_purchase"?"Purchased by: ":"Paid by: ",a.owner.owner_name]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),oe(a.created_at)]}),a.due_date&&e.jsxs("span",{children:["Due: ",oe(a.due_date)]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`text-lg font-semibold ${c(a.type)}`,children:[a.type==="new_purchase"?"+":"-",W(parseFloat(a.amount.toString()))]})})]})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet with this supplier"})]})})]})})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["Pay Due to ",r.name]}),e.jsxs("form",{onSubmit:je,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:f,onChange:a=>A(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter payment amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:B,onChange:a=>O(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Payment description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Made By"}),e.jsxs("select",{value:P,onChange:a=>T(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select who made this payment"}),C.map(a=>e.jsxs("option",{value:a.id,children:[a.owner_name," ",a.is_primary&&"(Primary)"," - ",a.role]},a.id))]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:["Current outstanding: ",e.jsx("span",{className:"font-medium",children:W(F)})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Process Payment"})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["New Purchase from ",r.name]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:m,onChange:a=>i(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter purchase amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:v,onChange:a=>j(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Purchase description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Made By"}),e.jsxs("select",{value:l,onChange:a=>p(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select who made this purchase"}),C.map(a=>e.jsxs("option",{value:a.id,children:[a.owner_name," ",a.is_primary&&"(Primary)"," - ",a.role]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:D,onChange:a=>_(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Purchase"})]})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-t-xl sm:rounded-xl w-full sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Supplier"}),e.jsx("button",{onClick:()=>z(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:"×"})]}),e.jsxs("form",{onSubmit:Ne,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Name *"}),e.jsx("input",{type:"text",value:L.name,onChange:a=>K({...L,name:a.target.value}),required:!0,className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",value:L.contact_person,onChange:a=>K({...L,contact_person:a.target.value}),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:L.phone,onChange:a=>K({...L,phone:a.target.value}),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:L.email,onChange:a=>K({...L,email:a.target.value}),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:L.address,onChange:a=>K({...L,address:a.target.value}),rows:3,className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"flex-1 px-4 py-2.5 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Update Supplier"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Supplier not found"}),e.jsx("button",{onClick:()=>n("/suppliers"),className:"text-blue-600 hover:text-blue-700",children:"Back to Suppliers"})]})},Us=({isOpen:t,onClose:s,onSubmit:n,suppliers:r,businessOwners:d})=>{const[u,h]=o.useState({supplier_id:"",type:"new_purchase",amount:"",description:"",owner_id:""}),C=w=>{w.preventDefault(),n(u),h({supplier_id:"",type:"new_purchase",amount:"",description:"",owner_id:""})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-t-xl sm:rounded-xl w-full sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Add Transaction"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:C,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transaction Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>h({...u,type:"new_purchase"}),className:`p-3 border rounded-lg text-center ${u.type==="new_purchase"?"border-red-500 bg-red-50 text-red-700":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(ge,{className:"h-4 w-4 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Purchase"})]}),e.jsxs("button",{type:"button",onClick:()=>h({...u,type:"pay_due"}),className:`p-3 border rounded-lg text-center ${u.type==="pay_due"?"border-green-500 bg-green-50 text-green-700":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(se,{className:"h-4 w-4 mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Payment"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier"}),e.jsxs("select",{value:u.supplier_id,onChange:w=>h({...u,supplier_id:w.target.value}),required:!0,className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Supplier"}),r.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (₹)"}),e.jsx("input",{type:"number",value:u.amount,onChange:w=>h({...u,amount:w.target.value}),required:!0,min:"0",step:"0.01",placeholder:"Enter amount",className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:u.type==="new_purchase"?"Purchased by":"Paid by"}),e.jsxs("select",{value:u.owner_id,onChange:w=>h({...u,owner_id:w.target.value}),className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select person"}),d.map(w=>e.jsx("option",{value:w.id,children:w.owner_name},w.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:u.description,onChange:w=>h({...u,description:w.target.value}),placeholder:"Add description...",className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3 pt-2",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2.5 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Transaction"})]})]})]})}):null},Rs=()=>{const{user:t}=R(),[s,n]=o.useState([]),[r,d]=o.useState([]),[u,h]=o.useState([]),[C,w]=o.useState(!0),[x,g]=o.useState(""),[S,k]=o.useState("all"),[N,b]=o.useState(!1);o.useEffect(()=>{f()},[t]);const f=async()=>{if(t)try{const{data:l,error:p}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name),
          owner:business_owners(owner_name)
        `).eq("user_id",t.id).order("created_at",{ascending:!1});if(p)throw p;const{data:v,error:j}=await y.from("suppliers").select("*").eq("user_id",t.id).order("name");if(j)throw j;const _=await J.getInstance().getBusinessOwners(t.id);n(l||[]),d(v||[]),h(_||[])}catch(l){console.error("Error fetching data:",l)}finally{w(!1)}},A=async l=>{if(t)try{const{error:p}=await y.from("transactions").insert([{...l,user_id:t.id,amount:parseFloat(l.amount)}]);if(p)throw p;await f(),b(!1)}catch(p){console.error("Error adding transaction:",p)}},P=s.filter(l=>{var j,D,_,B,O;const p=((j=l.description)==null?void 0:j.toLowerCase().includes(x.toLowerCase()))||((_=(D=l.supplier)==null?void 0:D.name)==null?void 0:_.toLowerCase().includes(x.toLowerCase()))||((O=(B=l.owner)==null?void 0:B.owner_name)==null?void 0:O.toLowerCase().includes(x.toLowerCase())),v=S==="all"||l.type===S;return p&&v}),T=l=>{switch(l){case"new_purchase":return e.jsx(Te,{className:"h-4 w-4 text-red-500"});case"pay_due":case"settle_bill":return e.jsx(Be,{className:"h-4 w-4 text-green-500"});default:return e.jsx(M,{className:"h-4 w-4 text-gray-500"})}},m=l=>{switch(l){case"new_purchase":return"Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return l}},i=l=>new Date(l).toLocaleDateString("en-IN",{month:"short",day:"numeric",year:"numeric"});return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Transactions"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Track all your business transactions"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-4 py-2.5 rounded-lg font-medium flex items-center justify-center hover:bg-blue-700 w-full sm:w-auto",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:x,onChange:l=>g(l.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(us,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:S,onChange:l=>k(l.target.value),className:"pl-10 pr-8 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"new_purchase",children:"Purchases"}),e.jsx("option",{value:"pay_due",children:"Payments"})]})]})]}),e.jsx("div",{className:"space-y-3",children:P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No transactions found"}),e.jsx("p",{className:"text-gray-400 text-sm",children:x?"Try adjusting your search":"Add your first transaction to get started"})]}):P.map(l=>{var p,v;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:T(l.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:(p=l.supplier)==null?void 0:p.name}),e.jsxs("p",{className:`font-semibold text-lg ${l.type==="new_purchase"?"text-red-600":"text-green-600"}`,children:[l.type==="new_purchase"?"+":"-","₹",Math.round(l.amount).toLocaleString()]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:m(l.type)}),l.description&&e.jsx("p",{className:"text-sm text-gray-500 mb-2 line-clamp-2",children:l.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),i(l.created_at)]}),((v=l.owner)==null?void 0:v.owner_name)&&e.jsxs("span",{className:"text-blue-600 font-medium",children:["by ",l.owner.owner_name]})]})]})]})})},l.id)})}),e.jsx(Us,{isOpen:N,onClose:()=>b(!1),onSubmit:A,suppliers:r,businessOwners:u})]})},Ms=()=>{const{user:t}=R(),[s,n]=o.useState({totalPurchases:0,totalPayments:0,netOutstanding:0,supplierBreakdown:[]}),[r,d]=o.useState([]),[u,h]=o.useState(!0),[C,w]=o.useState(""),[x,g]=o.useState("");o.useEffect(()=>{const f=new Date,A=new Date(f);A.setDate(f.getDate()-30),w(A.toISOString().split("T")[0]),g(f.toISOString().split("T")[0])},[]),o.useEffect(()=>{C&&x&&S()},[t,C,x]);const S=async()=>{if(t)try{h(!0);const{data:f,error:A}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name)
        `).eq("user_id",t.id).gte("created_at",C).lte("created_at",x+"T23:59:59").order("created_at",{ascending:!1});if(A)throw A;d(f||[]);const P=new Map;let T=0,m=0;f==null||f.forEach(p=>{var _;const v=((_=p.supplier)==null?void 0:_.name)||"Unknown",j=parseFloat(p.amount.toString());P.has(v)||P.set(v,{supplier:v,purchases:0,payments:0,outstanding:0});const D=P.get(v);p.type==="new_purchase"?(D.purchases+=j,T+=j,p.is_paid||(D.outstanding+=j)):(p.type==="pay_due"||p.type==="settle_bill")&&(D.payments+=j,m+=j,D.outstanding-=j),P.set(v,D)});const i=Array.from(P.values()).sort((p,v)=>v.outstanding-p.outstanding),l=i.reduce((p,v)=>p+v.outstanding,0);n({totalPurchases:T,totalPayments:m,netOutstanding:Math.max(0,l),supplierBreakdown:i})}catch(f){console.error("Error fetching report data:",f)}finally{h(!1)}},k=()=>{const f=["Date","Supplier","Type","Description","Amount","Status","Due Date"],A=r.map(l=>{var p;return[new Date(l.created_at).toLocaleDateString("en-IN"),((p=l.supplier)==null?void 0:p.name)||"Unknown",N(l.type),l.description,parseFloat(l.amount.toString()),l.is_paid?"Paid":"Unpaid",l.due_date?new Date(l.due_date).toLocaleDateString("en-IN"):""]}),P=[f.join(","),...A.map(l=>l.map(p=>`"${p}"`).join(","))].join(`
`),T=new Blob([P],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),i=URL.createObjectURL(T);m.setAttribute("href",i),m.setAttribute("download",`transactions-report-${C}-to-${x}.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)},N=f=>{switch(f){case"new_purchase":return"New Purchase";case"pay_due":return"Payment";case"settle_bill":return"Settlement";default:return f}},b=f=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Analyze your supplier transactions and dues"})]}),e.jsxs("button",{onClick:k,disabled:r.length===0,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:C,onChange:f=>w(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:x,onChange:f=>g(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),r.length," transactions found"]})]})}),u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:b(s.totalPurchases)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(ms,{className:"h-6 w-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:b(s.totalPayments)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(xs,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Net Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b(s.netOutstanding)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"h-6 w-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Supplier Breakdown"}),e.jsx(hs,{className:"h-5 w-5 text-gray-400"})]}),s.supplierBreakdown.length>0?e.jsx("div",{className:"space-y-4",children:s.supplierBreakdown.map((f,A)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:f.supplier}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["Outstanding: ",b(f.outstanding)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Purchases"}),e.jsx("p",{className:"font-medium text-red-600",children:b(f.purchases)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Payments"}),e.jsx("p",{className:"font-medium text-green-600",children:b(f.payments)})]})]})]},A))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($e,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No data available for the selected period"})]})]})]})]})};class Z{constructor(){this.isAuthenticated=!1,this.userEmail=""}static getInstance(){return Z.instance||(Z.instance=new Z),Z.instance}async initializeGoogleDrive(){console.log("Initializing Google Drive API...")}async authenticate(){try{return new Promise(s=>{setTimeout(()=>{this.isAuthenticated=!0,this.userEmail="user@gmail.com",s({success:!0,userEmail:this.userEmail})},2e3)})}catch(s){return console.error("Google Drive authentication failed:",s),{success:!1,userEmail:""}}}isConnected(){return this.isAuthenticated}getConnectedEmail(){return this.userEmail}async createBackup(s){try{return console.log("Creating backup on Google Drive...",s),new Promise(n=>{setTimeout(()=>{n({success:!0,fileId:`shopsynk-backup-${Date.now()}`})},3e3)})}catch(n){return console.error("Backup creation failed:",n),{success:!1}}}async scheduleAutoBackup(s){console.log("Auto backup scheduled for midnight daily");const n=new Date,r=new Date;r.setHours(24,0,0,0);const d=r.getTime()-n.getTime();setTimeout(()=>{s(),setInterval(s,24*60*60*1e3)},d)}disconnect(){this.isAuthenticated=!1,this.userEmail=""}}class X{constructor(){this.googleDriveService=Z.getInstance()}static getInstance(){return X.instance||(X.instance=new X),X.instance}async exportUserData(s,n){try{const{data:r,error:d}=await y.from("suppliers").select("*").eq("user_id",s);if(d)throw d;const{data:u,error:h}=await y.from("transactions").select(`
          *,
          supplier:suppliers(name, contact_person, phone, email)
        `).eq("user_id",s);if(h)throw h;return{suppliers:r||[],transactions:u||[],exportDate:new Date().toISOString(),userEmail:n}}catch(r){return console.error("Error exporting user data:",r),null}}async createBackup(s,n){try{if(!this.googleDriveService.isConnected())return{success:!1,message:"Google Drive not connected. Please connect first."};const r=await this.exportUserData(s,n);if(!r)return{success:!1,message:"Failed to export user data."};const d=await this.googleDriveService.createBackup(r);return d.success?(await this.recordBackup(s,d.fileId||"",r),{success:!0,message:"Backup created successfully on Google Drive!"}):{success:!1,message:"Failed to upload backup to Google Drive."}}catch(r){return console.error("Backup creation error:",r),{success:!1,message:"An error occurred during backup creation."}}}async recordBackup(s,n,r){try{await y.from("user_backups").insert([{user_id:s,backup_date:new Date().toISOString(),google_drive_file_id:n,suppliers_count:r.suppliers.length,transactions_count:r.transactions.length,backup_size:JSON.stringify(r).length,status:"completed"}])}catch(d){console.error("Error recording backup:",d)}}async setupAutoBackup(s,n){const r=async()=>{console.log("Running automatic backup...");const d=await this.createBackup(s,n);console.log("Auto backup result:",d.message),await this.sendBackupNotification(n,d.success)};await this.googleDriveService.scheduleAutoBackup(r)}async sendBackupNotification(s,n){console.log(`Backup notification sent to ${s}: ${n?"Success":"Failed"}`)}async getBackupHistory(s){try{const{data:n,error:r}=await y.from("user_backups").select("*").eq("user_id",s).order("backup_date",{ascending:!1}).limit(10);if(r)throw r;return n||[]}catch(n){return console.error("Error fetching backup history:",n),[]}}downloadBackupFile(s){const n=JSON.stringify(s,null,2),r=new Blob([n],{type:"application/json"}),d=URL.createObjectURL(r),u=document.createElement("a");u.href=d,u.download=`shopsynk-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}}const qs=()=>{const{user:t}=R(),[s,n]=o.useState(null),[r,d]=o.useState(!0),[u,h]=o.useState("pdf"),[C,w]=o.useState(!1),[x,g]=o.useState(!1),[S,k]=o.useState("");o.useEffect(()=>{N()},[t]);const N=async()=>{if(t)try{d(!0);const{count:l}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:p}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:v}=await y.from("business_owners").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:j}=await y.from("user_backups").select("created_at").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1).single(),D=.5,_=.3,B=.2,O=.1,F=(l||0)*D,q=(p||0)*_,V=(v||0)*B,z=F+q+V+O;n({totalTransactions:l||0,totalSuppliers:p||0,totalOwners:v||0,estimatedSizeKB:z,lastBackup:(j==null?void 0:j.created_at)||null,dataBreakdown:{transactions:{count:l||0,sizeKB:F},suppliers:{count:p||0,sizeKB:q},owners:{count:v||0,sizeKB:V},settings:{count:1,sizeKB:O}}})}catch(l){console.error("Error fetching storage stats:",l)}finally{d(!1)}},b=async l=>{if(t)try{w(!0);const[p,v,j]=await Promise.all([y.from("transactions").select("*, supplier:suppliers(name), owner:business_owners(owner_name)").eq("user_id",t.id).order("created_at",{ascending:!1}),y.from("suppliers").select("*").eq("user_id",t.id).order("name"),y.from("business_owners").select("*").eq("user_id",t.id).order("owner_name")]),D={exportDate:new Date().toISOString(),user:{id:t.id,email:t.email},summary:s,data:{transactions:p.data||[],suppliers:v.data||[],businessOwners:j.data||[]}};l==="json"?f(D):l==="csv"?A(D):l==="pdf"&&P(D)}catch(p){console.error("Error downloading data:",p),alert("Error downloading data. Please try again.")}finally{w(!1)}},f=l=>{const p=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),v=URL.createObjectURL(p),j=document.createElement("a");j.href=v,j.download=`shopsynk-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(v)},A=l=>{let p="Type,Supplier,Amount,Description,Date,Due Date,Status,Handled By\\n";l.data.transactions.forEach(_=>{var B,O;p+=`${_.type},"${((B=_.supplier)==null?void 0:B.name)||"Unknown"}",${_.amount},"${_.description}",${_.created_at},${_.due_date||""},${_.is_paid?"Paid":"Unpaid"},"${((O=_.owner)==null?void 0:O.owner_name)||"Unknown"}"\\n`});const v=new Blob([p],{type:"text/csv"}),j=URL.createObjectURL(v),D=document.createElement("a");D.href=j,D.download=`shopsynk-transactions-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(j)},P=l=>{const p=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Shopsynk Data Export</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1, h2 { color: #2563eb; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f8f9fa; }
          .summary { background-color: #f0f9ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <h1>Shopsynk Data Export</h1>
        <p><strong>Export Date:</strong> ${new Date().toLocaleDateString()}</p>
        <p><strong>User:</strong> ${(t==null?void 0:t.email)||"Unknown"}</p>
        
        <div class="summary">
          <h2>Summary</h2>
          <p><strong>Total Transactions:</strong> ${s==null?void 0:s.totalTransactions}</p>
          <p><strong>Total Suppliers:</strong> ${s==null?void 0:s.totalSuppliers}</p>
          <p><strong>Total Owners:</strong> ${s==null?void 0:s.totalOwners}</p>
          <p><strong>Estimated Size:</strong> ${((s==null?void 0:s.estimatedSizeKB)||0).toFixed(2)} KB</p>
        </div>

        <h2>Recent Transactions</h2>
        <table>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Supplier</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Handled By</th>
          </tr>
          ${l.data.transactions.slice(0,50).map(_=>{var B,O;return`
            <tr>
              <td>${new Date(_.created_at).toLocaleDateString()}</td>
              <td>${_.type}</td>
              <td>${((B=_.supplier)==null?void 0:B.name)||"Unknown"}</td>
              <td>₹${_.amount}</td>
              <td>${_.is_paid?"Paid":"Unpaid"}</td>
              <td>${((O=_.owner)==null?void 0:O.owner_name)||"Unknown"}</td>
            </tr>
          `}).join("")}
        </table>
      </body>
      </html>
    `,v=new Blob([p],{type:"text/html"}),j=URL.createObjectURL(v),D=document.createElement("a");D.href=j,D.download=`shopsynk-report-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(j)},T=async()=>{if(t)try{g(!0),k("Preparing backup...");const l=X.getInstance();k("Creating backup..."),await l.createBackup(t.id,t.email||"unknown@email.com"),k("Backup completed successfully!"),setTimeout(()=>k(""),3e3),await N()}catch(l){console.error("Error creating manual backup:",l),k("Backup failed. Please try again."),setTimeout(()=>k(""),3e3)}finally{g(!1)}},m=l=>l<1?`${(l*1024).toFixed(0)} bytes`:l<1024?`${l.toFixed(2)} KB`:`${(l/1024).toFixed(2)} MB`,i=l=>l?new Date(l).toLocaleString():"Never";return r?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(H,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading storage information..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Data Storage & Export"}),e.jsxs("button",{onClick:N,className:"flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Storage"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m((s==null?void 0:s.estimatedSizeKB)||0)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalTransactions})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalSuppliers})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Business Owners"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.totalOwners})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Storage Breakdown"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-5 w-5 text-green-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Transactions Data"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.transactions.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:m((s==null?void 0:s.dataBreakdown.transactions.sizeKB)||0)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"h-5 w-5 text-purple-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Suppliers Data"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.suppliers.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:m((s==null?void 0:s.dataBreakdown.suppliers.sizeKB)||0)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 text-orange-500 mr-3"}),e.jsx("span",{className:"font-medium",children:"Business Owners"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.dataBreakdown.owners.count," records"]}),e.jsx("p",{className:"text-sm text-gray-500",children:m((s==null?void 0:s.dataBreakdown.owners.sizeKB)||0)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Data"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),e.jsxs("select",{value:u,onChange:l=>h(l.target.value),className:"w-full md:w-64 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"pdf",children:"PDF Report"}),e.jsx("option",{value:"csv",children:"CSV (Spreadsheet)"}),e.jsx("option",{value:"json",children:"JSON (Raw Data)"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{onClick:()=>b(u),disabled:C,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[C?e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(be,{className:"h-4 w-4 mr-2"}),C?"Preparing...":`Download ${u.toUpperCase()}`]})}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• PDF: Formatted report with summary and recent transactions"}),e.jsx("p",{children:"• CSV: Spreadsheet format for analysis and import"}),e.jsx("p",{children:"• JSON: Complete raw data for technical use"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Backup Management"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-6 w-6 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Last Backup"}),e.jsx("p",{className:"text-sm text-blue-700",children:i((s==null?void 0:s.lastBackup)||null)})]})]}),e.jsxs("button",{onClick:T,disabled:x,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[x?e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ps,{className:"h-4 w-4 mr-2"}),x?"Creating Backup...":"Create Backup Now"]})]}),S&&e.jsxs("div",{className:`flex items-center p-3 rounded-lg ${S.includes("failed")?"bg-red-50 border border-red-200 text-red-700":S.includes("success")?"bg-green-50 border border-green-200 text-green-700":"bg-yellow-50 border border-yellow-200 text-yellow-700"}`,children:[S.includes("failed")?e.jsx(xe,{className:"h-5 w-5 mr-2"}):S.includes("success")?e.jsx(he,{className:"h-5 w-5 mr-2"}):e.jsx(H,{className:"h-5 w-5 mr-2 animate-spin"}),S]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• Automatic backups run daily when configured"}),e.jsx("p",{children:"• Manual backups are stored in your connected Google Drive"}),e.jsx("p",{children:"• Configure automatic backups in your Profile settings"})]})]})]})]})},zs=()=>{const{user:t}=R(),[s,n]=o.useState({suppliersCount:0,transactionsCount:0,totalOutstanding:0,lastLogin:""}),[r,d]=o.useState(!0),[u,h]=o.useState({isConnected:!1,userEmail:"",lastBackup:"",autoBackupEnabled:!0}),[C,w]=o.useState([]),[x,g]=o.useState(!1),[S,k]=o.useState(!1),[N,b]=o.useState(""),f=X.getInstance(),A=Z.getInstance(),P=J.getInstance(),[T,m]=o.useState([]),[i,l]=o.useState([]),[p,v]=o.useState(!1),[j,D]=o.useState(null),[_,B]=o.useState({owner_name:"",role:"Owner"}),[O,F]=o.useState("");o.useEffect(()=>{oe(),V(),z(),q()},[t]);const q=async()=>{var c;if(t)try{await P.ensurePrimaryOwner(t.id,t.email,(c=t.user_metadata)==null?void 0:c.full_name);const a=await P.getBusinessOwners(t.id);m(a);const E=await P.getOwnerStats(t.id);l(E)}catch(a){console.error("Error loading business owners:",a),F("Error loading business owners.")}},V=async()=>{if(t)try{const{data:c,error:a}=await y.from("user_settings").select("*").eq("user_id",t.id).single();if(a&&a.code!=="PGRST116")throw a;c&&h({isConnected:c.google_drive_connected||!1,userEmail:c.google_drive_email||"",lastBackup:c.last_backup_date||"",autoBackupEnabled:c.auto_backup_enabled||!0})}catch(c){console.error("Error loading Google Drive settings:",c)}},z=async()=>{if(t)try{const c=await f.getBackupHistory(t.id);w(c)}catch(c){console.error("Error loading backup history:",c)}},L=async()=>{g(!0),b("");try{const c=await A.authenticate();c.success?(await y.from("user_settings").upsert({user_id:t==null?void 0:t.id,google_drive_connected:!0,google_drive_email:c.userEmail,updated_at:new Date().toISOString()}),h(a=>({...a,isConnected:!0,userEmail:c.userEmail})),b("Successfully connected to Google Drive!"),await f.setupAutoBackup(t.id,t.email)):b("Failed to connect to Google Drive. Please try again.")}catch(c){console.error("Google Drive connection error:",c),b("An error occurred while connecting to Google Drive.")}finally{g(!1)}},K=async()=>{try{A.disconnect(),await y.from("user_settings").upsert({user_id:t==null?void 0:t.id,google_drive_connected:!1,google_drive_email:null,updated_at:new Date().toISOString()}),h(c=>({...c,isConnected:!1,userEmail:""})),b("Disconnected from Google Drive.")}catch(c){console.error("Error disconnecting Google Drive:",c),b("Error disconnecting from Google Drive.")}},I=async()=>{if(t){k(!0),b("");try{const c=await f.createBackup(t.id,t.email);b(c.message),c.success&&(await z(),await V())}catch(c){console.error("Manual backup error:",c),b("An error occurred during backup.")}finally{k(!1)}}},ye=async()=>{if(t)try{const c=await f.exportUserData(t.id,t.email);c?(f.downloadBackupFile(c),b("Backup file downloaded successfully!")):b("Failed to create backup file.")}catch(c){console.error("Download backup error:",c),b("Error creating backup file.")}},Q=async()=>{if(t)try{const c=!u.autoBackupEnabled;await y.from("user_settings").upsert({user_id:t.id,auto_backup_enabled:c,updated_at:new Date().toISOString()}),h(a=>({...a,autoBackupEnabled:c})),b(`Auto backup ${c?"enabled":"disabled"}.`)}catch(c){console.error("Error toggling auto backup:",c),b("Error updating auto backup setting.")}},je=async c=>{if(c.preventDefault(),!!t)try{const a=await P.createBusinessOwner(t.id,_);a.success?(F("Owner added successfully!"),await q(),ne()):F(`Error: ${a.error}`)}catch(a){console.error("Error adding owner:",a),F("An error occurred while adding the owner.")}},we=c=>{D(c),B({owner_name:c.owner_name,role:c.role}),v(!0)},Ne=async c=>{if(c.preventDefault(),!!j)try{const a=await P.updateBusinessOwner(j.id,_);a.success?(F("Owner updated successfully!"),await q(),ne()):F(`Error: ${a.error}`)}catch(a){console.error("Error updating owner:",a),F("An error occurred while updating the owner.")}},ve=async c=>{if(confirm("Are you sure you want to remove this owner? This action cannot be undone."))try{const a=await P.deactivateBusinessOwner(c);a.success?(F("Owner removed successfully."),await q()):F(`Error: ${a.error}`)}catch(a){console.error("Error removing owner:",a),F("An error occurred while removing the owner.")}},ne=()=>{B({owner_name:"",role:"Owner"}),D(null),v(!1)},W=c=>i.find(a=>a.owner_id===c)||{total_transactions:0,total_purchases:0,total_payments:0,total_purchase_amount:0,total_payment_amount:0},oe=async()=>{if(t)try{const{count:c}=await y.from("suppliers").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{count:a}=await y.from("transactions").select("*",{count:"exact",head:!0}).eq("user_id",t.id),{data:E}=await y.from("transactions").select("type, amount, is_paid").eq("user_id",t.id);let $=0;E==null||E.forEach(G=>{G.type==="new_purchase"&&!G.is_paid?$+=parseFloat(G.amount.toString()):(G.type==="pay_due"||G.type==="settle_bill")&&($-=parseFloat(G.amount.toString()))}),n({suppliersCount:c||0,transactionsCount:a||0,totalOutstanding:Math.max(0,$),lastLogin:t.last_sign_in_at||t.created_at||""})}catch(c){console.error("Error fetching user stats:",c)}finally{d(!1)}},ce=c=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),ee=c=>new Date(c).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your account settings and view activity"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Account Information"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(re,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Address"}),e.jsx("p",{className:"font-medium text-gray-900",children:t==null?void 0:t.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(gs,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Status"}),e.jsx("p",{className:"font-medium text-green-600",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Account Created"}),e.jsx("p",{className:"font-medium text-gray-900",children:t!=null&&t.created_at?ee(t.created_at):"N/A"})]})]}),s.lastLogin&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Sign In"}),e.jsx("p",{className:"font-medium text-gray-900",children:ee(s.lastLogin)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Summary"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(me,{className:"h-6 w-6 text-green-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Suppliers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:s.suppliersCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:s.transactionsCount})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Outstanding Amount"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:ce(s.totalOutstanding)})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Business Owners"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage owners and track their activities"})]})]}),e.jsxs("button",{onClick:()=>v(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"Add Owner"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(c=>{const a=W(c.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:c.is_primary?e.jsx(fs,{className:"h-5 w-5 text-yellow-500"}):e.jsx(pe,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:c.owner_name}),e.jsx("p",{className:"text-sm text-gray-600",children:c.role}),c.is_primary&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full",children:"Primary"})]})]}),!c.is_primary&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>we(c),className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Edit owner",children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ve(c.id),className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Remove owner",children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-blue-600 font-medium",children:a.total_purchases}),e.jsx("p",{className:"text-gray-500",children:"Purchases"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-green-600 font-medium",children:a.total_payments}),e.jsx("p",{className:"text-gray-500",children:"Payments"})]}),e.jsxs("div",{className:"col-span-2 text-center",children:[e.jsx("p",{className:"text-purple-600 font-medium",children:ce(a.total_purchase_amount-a.total_payment_amount)}),e.jsx("p",{className:"text-gray-500",children:"Net Activity"})]})]})})]},c.id)})}),T.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No business owners found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add owners to track who handles transactions"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Google Drive Backup"}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(Re,{className:"h-6 w-6 text-blue-600"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[u.isConnected?e.jsx(he,{className:"h-5 w-5 text-green-500"}):e.jsx(Ce,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Connection Status"}),e.jsx("p",{className:`font-medium ${u.isConnected?"text-green-600":"text-red-600"}`,children:u.isConnected?"Connected":"Not Connected"}),u.isConnected&&u.userEmail&&e.jsx("p",{className:"text-xs text-gray-500",children:u.userEmail})]})]}),u.isConnected&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ys,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Auto Backup"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Daily at midnight"})]})]}),e.jsx("button",{onClick:Q,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u.autoBackupEnabled?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u.autoBackupEnabled?"translate-x-6":"translate-x-1"}`})})]}),u.lastBackup&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Backup"}),e.jsx("p",{className:"font-medium text-gray-900",children:ee(u.lastBackup)})]})]}),e.jsx("div",{className:"flex space-x-3",children:u.isConnected?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,disabled:S,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:bg-green-400 flex items-center justify-center",children:S?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Backing up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Backup Now"]})}),e.jsx("button",{onClick:K,className:"px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors",children:"Disconnect"})]}):e.jsx("button",{onClick:L,disabled:x,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-400 flex items-center justify-center",children:x?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Connect Google Drive"]})})}),e.jsxs("button",{onClick:ye,className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Download Local Backup"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Backup History"}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(js,{className:"h-6 w-6 text-green-600"})})]}),e.jsx("div",{className:"space-y-3",children:C.length>0?C.slice(0,5).map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${c.status==="completed"?"bg-green-500":c.status==="failed"?"bg-red-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ee(c.backup_date)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c.suppliers_count," suppliers, ",c.transactions_count," transactions"]})]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${c.status==="completed"?"bg-green-100 text-green-700":c.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:c.status})]},c.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No backups yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Connect Google Drive to start automatic backups"})]})})]})]}),N&&e.jsx("div",{className:`border rounded-lg p-4 ${N.includes("Success")||N.includes("successfully")?"bg-green-50 border-green-200":N.includes("Error")||N.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[N.includes("Success")||N.includes("successfully")?e.jsx(he,{className:"h-5 w-5 text-green-600 mt-0.5"}):N.includes("Error")||N.includes("Failed")?e.jsx(Ce,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(xe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${N.includes("Success")||N.includes("successfully")?"text-green-800":N.includes("Error")||N.includes("Failed")?"text-red-800":"text-blue-800"}`,children:N})})]})}),O&&e.jsx("div",{className:`border rounded-lg p-4 ${O.includes("Success")||O.includes("successfully")?"bg-green-50 border-green-200":O.includes("Error")||O.includes("Failed")?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[O.includes("Success")||O.includes("successfully")?e.jsx(he,{className:"h-5 w-5 text-green-600 mt-0.5"}):O.includes("Error")||O.includes("Failed")?e.jsx(Ce,{className:"h-5 w-5 text-red-600 mt-0.5"}):e.jsx(xe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:`text-sm font-medium ${O.includes("Success")||O.includes("successfully")?"text-green-800":O.includes("Error")||O.includes("Failed")?"text-red-800":"text-blue-800"}`,children:O})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:j?"Edit Owner":"Add New Owner"}),e.jsxs("form",{onSubmit:j?Ne:je,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Owner Name *"}),e.jsx("input",{type:"text",required:!0,value:_.owner_name,onChange:c=>B({..._,owner_name:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter owner's full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role/Title"}),e.jsx("input",{type:"text",value:_.role,onChange:c=>B({..._,role:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"e.g., Owner, Partner, Manager"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:ne,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:j?"Update Owner":"Add Owner"})]})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(xe,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Your data is securely stored and encrypted. Always sign out when using shared devices. If you notice any unusual activity, please contact support immediately."})]})]})})]})};function Gs(){return e.jsx(Ps,{children:e.jsx(as,{children:e.jsx("div",{className:"App",children:e.jsxs(Le,{children:[e.jsx(U,{path:"/login",element:e.jsx(Ts,{})}),e.jsx(U,{path:"/register",element:e.jsx(Is,{})}),e.jsx(U,{path:"/*",element:e.jsx(Es,{children:e.jsx(Bs,{children:e.jsxs(Le,{children:[e.jsx(U,{path:"/",element:e.jsx(Fs,{})}),e.jsx(U,{path:"/suppliers",element:e.jsx(Ls,{})}),e.jsx(U,{path:"/suppliers/:id",element:e.jsx($s,{})}),e.jsx(U,{path:"/transactions",element:e.jsx(Rs,{})}),e.jsx(U,{path:"/reports",element:e.jsx(Ms,{})}),e.jsx(U,{path:"/data-storage",element:e.jsx(qs,{})}),e.jsx(U,{path:"/profile",element:e.jsx(zs,{})}),e.jsx(U,{path:"*",element:e.jsx(qe,{to:"/",replace:!0})})]})})})})]})})})})}Ze(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Gs,{})}));
